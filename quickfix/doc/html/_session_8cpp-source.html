<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/orenmnero/autobuild/quickfix/src/C++/Session.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.3.6-20040222 -->
<h1>/home/orenmnero/autobuild/quickfix/src/C++/Session.cpp</h1><a href="_session_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** Copyright (c) quickfixengine.org  All rights reserved.</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** This file is part of the QuickFIX FIX Engine</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file may be distributed under the terms of the quickfixengine.org</span>
00007 <span class="comment">** license as defined by quickfixengine.org and appearing in the file</span>
00008 <span class="comment">** LICENSE included in the packaging of this file.</span>
00009 <span class="comment">**</span>
00010 <span class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00011 <span class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00012 <span class="comment">**</span>
00013 <span class="comment">** See http://www.quickfixengine.org/LICENSE for licensing information.</span>
00014 <span class="comment">**</span>
00015 <span class="comment">** Contact ask@quickfixengine.org if any conditions of this licensing are</span>
00016 <span class="comment">** not clear to you.</span>
00017 <span class="comment">**</span>
00018 <span class="comment">****************************************************************************/</span>
00019 
00020 <span class="preprocessor">#ifdef _MSC_VER</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include "stdafx.h"</span>
00022 <span class="preprocessor">#else</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="_call_stack_8h.html">CallStack.h</a>"</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="_session_8h.html">Session.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="_values_8h.html">Values.h</a>"</span>
00029 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00030 <span class="preprocessor">#include &lt;iostream&gt;</span>
00031 
00032 <span class="keyword">namespace </span>FIX
00033 {
<a name="l00034"></a><a class="code" href="class_f_i_x_1_1_session.html#v0">00034</a> Session::Sessions Session::s_sessions;
<a name="l00035"></a><a class="code" href="class_f_i_x_1_1_session.html#v1">00035</a> Session::SessionIDs Session::s_sessionIDs;
<a name="l00036"></a><a class="code" href="class_f_i_x_1_1_session.html#v2">00036</a> Session::Sessions Session::s_registered;
<a name="l00037"></a><a class="code" href="class_f_i_x_1_1_session.html#v3">00037</a> <a class="code" href="class_f_i_x_1_1_mutex.html">Mutex</a> Session::s_mutex;
00038 
<a name="l00039"></a><a class="code" href="_session_8cpp.html#a0">00039</a> <span class="preprocessor">#define LOGEX( method ) try { method; } catch( std::exception&amp; e ) \</span>
00040 <span class="preprocessor">  { m_state.onEvent( e.what() ); }</span>
00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="class_f_i_x_1_1_session.html#a0">00042</a> Session::Session( <a class="code" href="class_f_i_x_1_1_application.html">Application</a>&amp; application,
00043                   <a class="code" href="class_f_i_x_1_1_message_store_factory.html">MessageStoreFactory</a>&amp; messageStoreFactory,
00044                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID,
00045                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary,
00046                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_time.html">SessionTime</a>&amp; sessionTime,
00047                   <span class="keywordtype">int</span> heartBtInt, <a class="code" href="class_f_i_x_1_1_log_factory.html">LogFactory</a>* pLogFactory )
00048 : m_application( application ),
00049   m_sessionID( sessionID ),
00050   m_sessionTime( sessionTime ),
00051   m_sendRedundantResendRequests( false ),
00052   m_checkCompId( true ),
00053   m_checkLatency( true ), 
00054   m_maxLatency( 120 ),
00055   m_resetOnLogon( false ),
00056   m_resetOnLogout( false ), 
00057   m_resetOnDisconnect( false ),
00058   m_millisecondsInTimeStamp( true ),
00059   m_persistMessages( true ),
00060   m_dataDictionary( dataDictionary ),
00061   m_messageStoreFactory( messageStoreFactory ),
00062   m_pLogFactory( pLogFactory ),
00063   m_pResponder( 0 )
00064 {
00065   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a28">heartBtInt</a>( heartBtInt );
00066   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">initiate</a>( heartBtInt != 0 );
00067   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a24">store</a>( m_messageStoreFactory.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a1">create</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> ) );
00068   <span class="keywordflow">if</span> ( m_pLogFactory )
00069     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a26">log</a>( m_pLogFactory-&gt;<a class="code" href="class_f_i_x_1_1_log_factory.html#a1">create</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> ) );
00070 
00071   <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#d7">checkSessionTime</a>( <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>() ) )
00072     <a class="code" href="class_f_i_x_1_1_session.html#a9">reset</a>();
00073 
00074   <a class="code" href="class_f_i_x_1_1_session.html#h0">addSession</a>( *<span class="keyword">this</span> );
00075   m_application.<a class="code" href="class_f_i_x_1_1_application.html#a1">onCreate</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
00076   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Created session"</span> );
00077 }
00078 
<a name="l00079"></a><a class="code" href="class_f_i_x_1_1_session.html#a1">00079</a> Session::~Session()
00080 { <a class="code" href="_call_stack_8h.html#a2">QF_STACK_IGNORE_BEGIN</a>
00081   <a class="code" href="class_f_i_x_1_1_session.html#h1">removeSession</a>( *<span class="keyword">this</span> );
00082   m_messageStoreFactory.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a2">destroy</a>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a24">store</a>() );
00083   <span class="keywordflow">if</span> ( m_pLogFactory &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a26">log</a>() )
00084     m_pLogFactory-&gt;<a class="code" href="class_f_i_x_1_1_log_factory.html#a3">destroy</a>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a26">log</a>() );
00085   <a class="code" href="_call_stack_8h.html#a3">QF_STACK_IGNORE_END</a>
00086 }
00087 
<a name="l00088"></a><a class="code" href="class_f_i_x_1_1_session.html#d3">00088</a> <span class="keywordtype">void</span> Session::insertSendingTime( <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header )
00089 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::insertSendingTime)
00090 
00091   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00092   <span class="keywordtype">bool</span> showMilliseconds = <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>() &gt;= <a class="code" href="namespace_f_i_x.html#a230">BeginString_FIX42</a>;
00093   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( SendingTime(now, showMilliseconds &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r11">m_millisecondsInTimeStamp</a>) );
00094 
00095   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00096 }
00097 
<a name="l00098"></a><a class="code" href="class_f_i_x_1_1_session.html#d4">00098</a> <span class="keywordtype">void</span> Session::insertOrigSendingTime( <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; when )
00099 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::insertSendingTime)
00100 
00101   <span class="keywordtype">bool</span> showMilliseconds = <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>() &gt;= <a class="code" href="namespace_f_i_x.html#a230">BeginString_FIX42</a>;
00102   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( OrigSendingTime(when, showMilliseconds &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r11">m_millisecondsInTimeStamp</a>) );
00103 
00104   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00105 }
00106 
<a name="l00107"></a><a class="code" href="class_f_i_x_1_1_session.html#d5">00107</a> <span class="keywordtype">void</span> Session::fill( <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header )
00108 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::fill)
00109 
00110   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00111   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a31">lastSentTime</a>( now );
00112   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>() );
00113   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a4">getSenderCompID</a>() );
00114   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a5">getTargetCompID</a>() );
00115   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgSeqNum( <a class="code" href="class_f_i_x_1_1_session.html#a49">getExpectedSenderNum</a>() ) );
00116   <a class="code" href="class_f_i_x_1_1_session.html#d3">insertSendingTime</a>( header );
00117 
00118   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00119 }
00120 
<a name="l00121"></a><a class="code" href="class_f_i_x_1_1_session.html#a45">00121</a> <span class="keywordtype">void</span> Session::next()
00122 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::next)
00123 
00124   <span class="keywordflow">try</span>
00125   {
00126     <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">isEnabled</a>() )
00127     {
00128       <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#a8">isLoggedOn</a>() )
00129       {
00130         <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>() )
00131         {
00132           <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Initiated logout request"</span> );
00133           <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a45">logoutReason</a>() );
00134         }
00135       }
00136       <span class="keywordflow">else</span>
00137         <span class="keywordflow">return</span>;
00138     }
00139 
00140     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00141     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d7">checkSessionTime</a>( now ) )
00142       { <a class="code" href="class_f_i_x_1_1_session.html#a9">reset</a>(); <span class="keywordflow">return</span>; }
00143 
00144     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() )
00145     {
00146       <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a37">shouldSendLogon</a>() )
00147       {
00148         <a class="code" href="class_f_i_x_1_1_session.html#d28">generateLogon</a>();
00149         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Initiated logon request"</span> );
00150       }
00151       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a38">alreadySentLogon</a>() &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a39">logonTimedOut</a>() )
00152       {
00153         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Timed out waiting for logon response"</span> );
00154         <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
00155       }
00156       <span class="keywordflow">return</span> ;
00157     }
00158 
00159     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a28">heartBtInt</a>() == 0 ) <span class="keywordflow">return</span> ;
00160 
00161     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a40">logoutTimedOut</a>() )
00162     {
00163       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Timed out waiting for logout response"</span> );
00164       <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
00165     }
00166 
00167     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a41">withinHeartBeat</a>() ) <span class="keywordflow">return</span> ;
00168 
00169     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a42">timedOut</a>() )
00170     {
00171       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Timed out waiting for heartbeat"</span> );
00172       <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
00173     }
00174     <span class="keywordflow">else</span>
00175     {
00176       <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">needTestRequest</a>() )
00177       {
00178         <a class="code" href="class_f_i_x_1_1_session.html#d34">generateTestRequest</a>( <span class="stringliteral">"TEST"</span> );
00179         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">testRequest</a>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">testRequest</a>() + 1 );
00180         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Sent test request TEST"</span> );
00181       }
00182       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a43">needHeartbeat</a>() )
00183       {
00184         <a class="code" href="class_f_i_x_1_1_session.html#d32">generateHeartbeat</a>();
00185       }
00186     }
00187   }
00188   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_i_o_exception.html">FIX::IOException</a>&amp; e )
00189   {
00190     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() );
00191     <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
00192   }
00193 
00194   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00195 }
00196 
<a name="l00197"></a><a class="code" href="class_f_i_x_1_1_session.html#d21">00197</a> <span class="keywordtype">void</span> Session::nextLogon( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logon )
00198 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextLogon)
00199 
00200   SenderCompID senderCompID;
00201   TargetCompID targetCompID;
00202   logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( senderCompID );
00203   logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( targetCompID );
00204 
00205   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r10">m_refreshOnLogon</a> )
00206     <a class="code" href="class_f_i_x_1_1_session.html#a10">refresh</a>();
00207 
00208   ResetSeqNumFlag resetSeqNumFlag(<span class="keyword">false</span>);
00209   <span class="keywordflow">if</span>( logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>(resetSeqNumFlag) )
00210     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( resetSeqNumFlag );
00211   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>( resetSeqNumFlag );
00212 
00213   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>() )
00214   {
00215     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Logon contains ResetSeqNumFlag=Y, reseting sequence numbers to 1"</span> );
00216     <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a11">sentReset</a>() ) <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a59">reset</a>();
00217   }
00218 
00219   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a37">shouldSendLogon</a>() &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>() )
00220   {
00221     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received logon response before sending request"</span> );
00222     <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
00223     <span class="keywordflow">return</span> ;
00224   }
00225 
00226   <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">initiate</a>() &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r7">m_resetOnLogon</a> )
00227     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a59">reset</a>();
00228 
00229   <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( logon, <span class="keyword">false</span>, <span class="keyword">true</span> ) )
00230     <span class="keywordflow">return</span>;
00231   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>( <span class="keyword">true</span> );
00232 
00233   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">initiate</a>() 
00234        || (<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a11">sentReset</a>() &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>()) )
00235   {
00236     <span class="keywordflow">if</span>( logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>(<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a28">heartBtInt</a>()) )
00237       logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a28">heartBtInt</a>() );
00238     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received logon request"</span> );
00239     <a class="code" href="class_f_i_x_1_1_session.html#d28">generateLogon</a>( logon );
00240     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Responding to logon request"</span> );
00241   }
00242   <span class="keywordflow">else</span>
00243     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received logon response"</span> );
00244 
00245   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a11">sentReset</a>( <span class="keyword">false</span> );
00246   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>( <span class="keyword">false</span> );
00247 
00248   MsgSeqNum msgSeqNum;
00249   logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00250   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#d8">isTargetTooHigh</a>( msgSeqNum ) &amp;&amp; !resetSeqNumFlag )
00251   {
00252     <a class="code" href="class_f_i_x_1_1_session.html#d18">doTargetTooHigh</a>( logon );
00253   }
00254   <span class="keywordflow">else</span>
00255   {
00256     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00257     <a class="code" href="class_f_i_x_1_1_session.html#d19">nextQueued</a>();
00258   }
00259 
00260   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#a8">isLoggedOn</a>() )
00261     m_application.<a class="code" href="class_f_i_x_1_1_application.html#a2">onLogon</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
00262 
00263   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00264 }
00265 
<a name="l00266"></a><a class="code" href="class_f_i_x_1_1_session.html#d22">00266</a> <span class="keywordtype">void</span> Session::nextHeartbeat( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; heartbeat )
00267 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextHeartbeat)
00268 
00269   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( heartbeat ) ) <span class="keywordflow">return</span> ;
00270   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00271   <a class="code" href="class_f_i_x_1_1_session.html#d19">nextQueued</a>();
00272 
00273   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00274 }
00275 
<a name="l00276"></a><a class="code" href="class_f_i_x_1_1_session.html#d23">00276</a> <span class="keywordtype">void</span> Session::nextTestRequest( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00277 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextTestRequest)
00278 
00279   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( testRequest ) ) <span class="keywordflow">return</span> ;
00280   <a class="code" href="class_f_i_x_1_1_session.html#d32">generateHeartbeat</a>( testRequest );
00281   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00282   <a class="code" href="class_f_i_x_1_1_session.html#d19">nextQueued</a>();
00283 
00284   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00285 }
00286 
<a name="l00287"></a><a class="code" href="class_f_i_x_1_1_session.html#d24">00287</a> <span class="keywordtype">void</span> Session::nextLogout( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logout )
00288 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextLogout)
00289 
00290   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( logout, <span class="keyword">false</span>, <span class="keyword">false</span> ) ) <span class="keywordflow">return</span> ;
00291   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>() )
00292   {
00293     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received logout request"</span> );
00294     <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>();
00295     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Sending logout response"</span> );
00296   }
00297   <span class="keywordflow">else</span>
00298     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received logout response"</span> );
00299 
00300   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00301   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r8">m_resetOnLogout</a> ) <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a59">reset</a>();
00302   <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
00303 
00304   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00305 }
00306 
<a name="l00307"></a><a class="code" href="class_f_i_x_1_1_session.html#d25">00307</a> <span class="keywordtype">void</span> Session::nextReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject )
00308 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextReject)
00309 
00310   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( reject, <span class="keyword">false</span>, <span class="keyword">true</span> ) ) <span class="keywordflow">return</span> ;
00311   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00312   <a class="code" href="class_f_i_x_1_1_session.html#d19">nextQueued</a>();
00313 
00314   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00315 }
00316 
<a name="l00317"></a><a class="code" href="class_f_i_x_1_1_session.html#d26">00317</a> <span class="keywordtype">void</span> Session::nextSequenceReset( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; sequenceReset )
00318 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextSequenceReset)
00319 
00320   <span class="keywordtype">bool</span> isGapFill = <span class="keyword">false</span>;
00321   GapFillFlag gapFillFlag;
00322   <span class="keywordflow">if</span> ( sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( gapFillFlag ) )
00323   {
00324     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( gapFillFlag );
00325     isGapFill = gapFillFlag;
00326   }
00327 
00328   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( sequenceReset, isGapFill, isGapFill ) ) <span class="keywordflow">return</span> ;
00329 
00330   NewSeqNo newSeqNo;
00331   <span class="keywordflow">if</span> ( sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( newSeqNo ) )
00332   {
00333     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( newSeqNo );
00334 
00335     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received SequenceReset FROM: "</span>
00336                      + IntConvertor::convert( <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() ) +
00337                      <span class="stringliteral">" TO: "</span> + IntConvertor::convert( newSeqNo ) );
00338 
00339     <span class="keywordflow">if</span> ( newSeqNo &gt; <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() )
00340       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a55">setNextTargetMsgSeqNum</a>( MsgSeqNum( newSeqNo ) );
00341     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( newSeqNo &lt; <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() )
00342       <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( sequenceReset, <a class="code" href="namespace_f_i_x.html#a1131">SessionRejectReason_VALUE_IS_INCORRECT</a> );
00343   }
00344 
00345   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00346 }
00347 
<a name="l00348"></a><a class="code" href="class_f_i_x_1_1_session.html#d27">00348</a> <span class="keywordtype">void</span> Session::nextResendRequest( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; resendRequest )
00349 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextResendRequest)
00350 
00351   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( resendRequest, <span class="keyword">false</span>, <span class="keyword">false</span> ) ) <span class="keywordflow">return</span> ;
00352 
00353   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> l( m_mutex );
00354 
00355   BeginSeqNo beginSeqNo;
00356   EndSeqNo endSeqNo;
00357   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( beginSeqNo );
00358   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( endSeqNo );
00359 
00360   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Received ResendRequest FROM: "</span>
00361        + IntConvertor::convert( beginSeqNo ) +
00362                    <span class="stringliteral">" TO: "</span> + IntConvertor::convert( endSeqNo ) );
00363 
00364   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>();
00365   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 &amp;&amp; endSeqNo == 0 ||
00366        beginString &lt;= FIX::BeginString_FIX42 &amp;&amp; endSeqNo == 999999 ||
00367        endSeqNo &gt;= <a class="code" href="class_f_i_x_1_1_session.html#a49">getExpectedSenderNum</a>() )
00368   { endSeqNo = <a class="code" href="class_f_i_x_1_1_session.html#a49">getExpectedSenderNum</a>() - 1; }
00369 
00370   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#r12">m_persistMessages</a> )
00371   {
00372     endSeqNo = EndSeqNo(endSeqNo + 1);
00373     <span class="keywordtype">int</span> <a class="code" href="class_f_i_x_1_1_session.html#a45">next</a> = <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a52">getNextSenderMsgSeqNum</a>();
00374     <span class="keywordflow">if</span>( endSeqNo &gt; next )
00375       endSeqNo = EndSeqNo(next);
00376     <a class="code" href="class_f_i_x_1_1_session.html#d31">generateSequenceReset</a>( beginSeqNo, endSeqNo );
00377     <span class="keywordflow">return</span>;
00378   }
00379 
00380   std::vector &lt; std::string &gt; messages;
00381   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a51">get</a>( beginSeqNo, endSeqNo, messages );
00382 
00383   std::vector &lt; std::string &gt; ::iterator i;
00384   MsgSeqNum msgSeqNum(0);
00385   MsgType msgType;
00386   <span class="keywordtype">int</span> begin = 0;
00387   <span class="keywordtype">int</span> current = beginSeqNo;
00388   std::string messageString;
00389 
00390   <span class="keywordflow">for</span> ( i = messages.begin(); i != messages.end(); ++i )
00391   {
00392     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> msg( *i, <a class="code" href="class_f_i_x_1_1_session.html#r14">m_dataDictionary</a> );
00393     msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00394     msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00395 
00396     <span class="keywordflow">if</span>( (current != msgSeqNum) &amp;&amp; !begin )
00397       begin = current;
00398 
00399     <span class="keywordflow">if</span> ( Message::isAdminMsgType( msgType ) )
00400     {
00401       <span class="keywordflow">if</span> ( !begin ) begin = msgSeqNum;
00402     }
00403     <span class="keywordflow">else</span>
00404     {
00405       <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#d2">resend</a>( msg ) )
00406       {
00407         <span class="keywordflow">if</span> ( begin ) <a class="code" href="class_f_i_x_1_1_session.html#d31">generateSequenceReset</a>( begin, msgSeqNum );
00408         <a class="code" href="class_f_i_x_1_1_session.html#a44">send</a>( msg.<a class="code" href="class_f_i_x_1_1_message.html#a11">toString</a>(messageString) );
00409         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Resending Message: "</span>
00410                          + IntConvertor::convert( msgSeqNum ) );
00411         begin = 0;
00412       }
00413       <span class="keywordflow">else</span>
00414       { <span class="keywordflow">if</span> ( !begin ) begin = msgSeqNum; }
00415     }
00416     current = msgSeqNum + 1;
00417   }
00418   <span class="keywordflow">if</span> ( begin )
00419   {
00420     <a class="code" href="class_f_i_x_1_1_session.html#d31">generateSequenceReset</a>( begin, msgSeqNum + 1 );
00421   }
00422 
00423   <span class="keywordflow">if</span> ( endSeqNo &gt; msgSeqNum )
00424   {
00425     endSeqNo = EndSeqNo(endSeqNo + 1);
00426     <span class="keywordtype">int</span> <a class="code" href="class_f_i_x_1_1_session.html#a45">next</a> = <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a52">getNextSenderMsgSeqNum</a>();
00427     <span class="keywordflow">if</span>( endSeqNo &gt; next )
00428       endSeqNo = EndSeqNo(next);
00429     <a class="code" href="class_f_i_x_1_1_session.html#d31">generateSequenceReset</a>( beginSeqNo, endSeqNo );
00430   }
00431 
00432   resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00433   <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#d8">isTargetTooHigh</a>(msgSeqNum) &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#d9">isTargetTooLow</a>(msgSeqNum) )
00434     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00435 
00436   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00437 }
00438 
<a name="l00439"></a><a class="code" href="class_f_i_x_1_1_session.html#a44">00439</a> <span class="keywordtype">bool</span> Session::send( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00440 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::send)
00441 
00442   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( FIELD::PossDupFlag );
00443   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( FIELD::OrigSendingTime );
00444   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( message );
00445 
00446   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00447 }
00448 
<a name="l00449"></a><a class="code" href="class_f_i_x_1_1_session.html#d1">00449</a> <span class="keywordtype">bool</span> Session::sendRaw( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">int</span> num )
00450 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::sendRaw)
00451 
00452   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> l( m_mutex );
00453 
00454   <span class="keywordflow">try</span>
00455   {
00456     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
00457     <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
00458 
00459     MsgType msgType;
00460     <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>(msgType) )
00461       header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00462 
00463     <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( header );
00464     std::string messageString;
00465 
00466     <span class="keywordflow">if</span> ( num )
00467       header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgSeqNum( num ) );
00468 
00469     <span class="keywordflow">if</span> ( Message::isAdminMsgType( msgType ) )
00470     {
00471       m_application.<a class="code" href="class_f_i_x_1_1_application.html#a4">toAdmin</a>( message, <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
00472 
00473       <span class="keywordflow">if</span>( msgType == <span class="stringliteral">"A"</span> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>() )
00474       {
00475         ResetSeqNumFlag resetSeqNumFlag( <span class="keyword">false</span> );
00476         <span class="keywordflow">if</span>( message.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>(resetSeqNumFlag) )
00477           message.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( resetSeqNumFlag );
00478         <span class="keywordflow">if</span>( resetSeqNumFlag )
00479         {
00480           <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a59">reset</a>();
00481           message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgSeqNum(<a class="code" href="class_f_i_x_1_1_session.html#a49">getExpectedSenderNum</a>()) );
00482         }
00483         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a11">sentReset</a>( resetSeqNumFlag );
00484       }
00485 
00486       message.<a class="code" href="class_f_i_x_1_1_message.html#a11">toString</a>( messageString );
00487 
00488       <span class="keywordflow">if</span> (
00489         msgType == <span class="stringliteral">"A"</span> || msgType == <span class="stringliteral">"5"</span>
00490         || msgType == <span class="stringliteral">"2"</span> || msgType == <span class="stringliteral">"4"</span>
00491         || <a class="code" href="class_f_i_x_1_1_session.html#a8">isLoggedOn</a>() )
00492       {
00493         result = <a class="code" href="class_f_i_x_1_1_session.html#a44">send</a>( messageString );
00494       }
00495     }
00496     <span class="keywordflow">else</span>
00497     {
00498       <span class="comment">// do not send application messages if they will just be cleared</span>
00499       <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#a8">isLoggedOn</a>() &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#d11">shouldSendReset</a>() )
00500         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00501 
00502       <span class="keywordflow">try</span>
00503       {
00504         m_application.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>( message, <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
00505         message.<a class="code" href="class_f_i_x_1_1_message.html#a11">toString</a>( messageString );
00506         <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#a8">isLoggedOn</a>() )
00507           result = <a class="code" href="class_f_i_x_1_1_session.html#a44">send</a>( messageString );
00508       }
00509       <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp; ) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00510     }
00511 
00512     <span class="keywordflow">if</span> ( !num )
00513     {
00514       MsgSeqNum msgSeqNum;
00515       header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00516       <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r12">m_persistMessages</a> )
00517         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a50">set</a>( msgSeqNum, messageString );
00518       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a56">incrNextSenderMsgSeqNum</a>();
00519     }
00520     <span class="keywordflow">return</span> result;
00521   }
00522   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_i_o_exception.html">IOException</a>&amp; e )
00523   {
00524     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() );
00525     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00526   }
00527 
00528   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00529 }
00530 
<a name="l00531"></a><a class="code" href="class_f_i_x_1_1_session.html#d0">00531</a> <span class="keywordtype">bool</span> Session::send( <span class="keyword">const</span> std::string&amp; string )
00532 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::send)
00533 
00534   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#r17">m_pResponder</a> ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00535   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a63">onOutgoing</a>( string );
00536   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#r17">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_responder.html#a1">send</a>( string );
00537 
00538   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00539 }
00540 
<a name="l00541"></a><a class="code" href="class_f_i_x_1_1_session.html#a48">00541</a> <span class="keywordtype">void</span> Session::disconnect()
00542 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::disconnect)
00543 
00544   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> l(m_mutex);
00545 
00546   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r17">m_pResponder</a> )
00547   {
00548     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Disconnecting"</span> );
00549 
00550     <a class="code" href="class_f_i_x_1_1_session.html#r17">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_responder.html#a2">disconnect</a>();
00551     <a class="code" href="class_f_i_x_1_1_session.html#r17">m_pResponder</a> = 0;
00552   }
00553 
00554   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() || <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>() )
00555   {
00556     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>( <span class="keyword">false</span> );
00557     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>( <span class="keyword">false</span> );
00558     m_application.<a class="code" href="class_f_i_x_1_1_application.html#a3">onLogout</a>( <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
00559   }
00560 
00561   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>( <span class="keyword">false</span> );
00562   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>( <span class="keyword">false</span> );
00563   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a11">sentReset</a>( <span class="keyword">false</span> );
00564   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">clearQueue</a>();
00565   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a45">logoutReason</a>();
00566   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#r9">m_resetOnDisconnect</a> )
00567     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a59">reset</a>();
00568 
00569   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a22">resendRange</a>( 0, 0 );
00570 
00571   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00572 }
00573 
<a name="l00574"></a><a class="code" href="class_f_i_x_1_1_session.html#d2">00574</a> <span class="keywordtype">bool</span> Session::resend( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00575 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::resend)
00576 
00577   SendingTime sendingTime;
00578   MsgSeqNum msgSeqNum;
00579   <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
00580   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( sendingTime );
00581   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00582   <a class="code" href="class_f_i_x_1_1_session.html#d4">insertOrigSendingTime</a>( header, sendingTime );
00583   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( PossDupFlag( <span class="keyword">true</span> ) );
00584   <a class="code" href="class_f_i_x_1_1_session.html#d3">insertSendingTime</a>( header );
00585 
00586   <span class="keywordflow">try</span>
00587   {
00588     m_application.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>( message, <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
00589     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00590   }
00591   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp; )
00592   { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00593 
00594   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00595 }
00596 
<a name="l00597"></a><a class="code" href="class_f_i_x_1_1_session.html#d28">00597</a> <span class="keywordtype">void</span> Session::generateLogon()
00598 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateLogon)
00599 
00600   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> <a class="code" href="class_f_i_x_1_1_session.html#a2">logon</a>;
00601   logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"A"</span> ) );
00602   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( EncryptMethod( 0 ) );
00603   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a28">heartBtInt</a>() );
00604 
00605   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r10">m_refreshOnLogon</a> )
00606     <a class="code" href="class_f_i_x_1_1_session.html#a10">refresh</a>();
00607   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r7">m_resetOnLogon</a> )
00608     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a59">reset</a>();
00609   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#d11">shouldSendReset</a>() )
00610     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( ResetSeqNumFlag(<span class="keyword">true</span>) );
00611 
00612   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00613   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00614   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a34">lastReceivedTime</a>( now );
00615   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">testRequest</a>( 0 );
00616   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>( <span class="keyword">true</span> );
00617   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( logon );
00618 
00619   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00620 }
00621 
<a name="l00622"></a><a class="code" href="class_f_i_x_1_1_session.html#d29">00622</a> <span class="keywordtype">void</span> Session::generateLogon( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; aLogon )
00623 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateLogon)
00624 
00625   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> <a class="code" href="class_f_i_x_1_1_session.html#a2">logon</a>;
00626   EncryptMethod encryptMethod;
00627   HeartBtInt heartBtInt;
00628   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( EncryptMethod( 0 ) );
00629   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>() )
00630     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( ResetSeqNumFlag(<span class="keyword">true</span>) );
00631   aLogon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( heartBtInt );
00632   logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"A"</span> ) );
00633   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( heartBtInt );
00634   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00635   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( logon );
00636   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>( <span class="keyword">true</span> );
00637 
00638   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00639 }
00640 
<a name="l00641"></a><a class="code" href="class_f_i_x_1_1_session.html#d30">00641</a> <span class="keywordtype">void</span> Session::generateResendRequest( <span class="keyword">const</span> BeginString&amp; beginString, <span class="keyword">const</span> MsgSeqNum&amp; msgSeqNum )
00642 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateResendRequest)
00643 
00644   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> resendRequest;
00645   BeginSeqNo beginSeqNo( ( <span class="keywordtype">int</span> ) <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() );
00646   EndSeqNo endSeqNo( msgSeqNum - 1 );
00647   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 )
00648     endSeqNo = 0;
00649   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( beginString &lt;= FIX::BeginString_FIX41 )
00650     endSeqNo = 999999;
00651   resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"2"</span> ) );
00652   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( beginSeqNo );
00653   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( endSeqNo );
00654   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00655   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( resendRequest );
00656 
00657   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Sent ResendRequest FROM: "</span>
00658                    + IntConvertor::convert( beginSeqNo ) +
00659                    <span class="stringliteral">" TO: "</span> + IntConvertor::convert( endSeqNo ) );
00660 
00661   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a22">resendRange</a>( beginSeqNo, msgSeqNum - 1 );
00662 
00663   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00664 }
00665 
00666 <span class="keywordtype">void</span> Session::generateSequenceReset
<a name="l00667"></a><a class="code" href="class_f_i_x_1_1_session.html#d31">00667</a> ( <span class="keywordtype">int</span> beginSeqNo, <span class="keywordtype">int</span> endSeqNo )
00668 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateSequenceReset)
00669 
00670   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> sequenceReset;
00671   NewSeqNo newSeqNo( endSeqNo );
00672   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"4"</span> ) );
00673   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( PossDupFlag( <span class="keyword">true</span> ) );
00674   sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( newSeqNo );
00675   fill( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00676 
00677   SendingTime sendingTime;
00678   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( sendingTime );
00679   insertOrigSendingTime( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>(), sendingTime );
00680   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgSeqNum( beginSeqNo ) );
00681   sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( GapFillFlag( <span class="keyword">true</span> ) );
00682   sendRaw( sequenceReset, beginSeqNo );
00683   m_state.onEvent( <span class="stringliteral">"Sent SequenceReset TO: "</span>
00684                    + IntConvertor::convert( newSeqNo ) );
00685 
00686   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00687 }
00688 
<a name="l00689"></a><a class="code" href="class_f_i_x_1_1_session.html#d32">00689</a> <span class="keywordtype">void</span> Session::generateHeartbeat()
00690 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateHeartbeat)
00691 
00692   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00693   heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"0"</span> ) );
00694   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00695   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( heartbeat );
00696 
00697   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00698 }
00699 
<a name="l00700"></a><a class="code" href="class_f_i_x_1_1_session.html#d33">00700</a> <span class="keywordtype">void</span> Session::generateHeartbeat( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00701 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateHeartbeat)
00702 
00703   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00704   heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"0"</span> ) );
00705   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00706   <span class="keywordflow">try</span>
00707   {
00708     TestReqID testReqID;
00709     testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( testReqID );
00710     heartbeat.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( testReqID );
00711   }
00712   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) {}
00713 
00714   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( heartbeat );
00715 
00716   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00717 }
00718 
<a name="l00719"></a><a class="code" href="class_f_i_x_1_1_session.html#d34">00719</a> <span class="keywordtype">void</span> Session::generateTestRequest( <span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span> )
00720 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateTestRequest)
00721 
00722   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> testRequest;
00723   testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"1"</span> ) );
00724   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00725   TestReqID testReqID( <span class="keywordtype">id</span> );
00726   testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( testReqID );
00727 
00728   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( testRequest );
00729 
00730   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00731 }
00732 
<a name="l00733"></a><a class="code" href="class_f_i_x_1_1_session.html#d35">00733</a> <span class="keywordtype">void</span> Session::generateReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">int</span> err, <span class="keywordtype">int</span> field )
00734 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateReject)
00735 
00736   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>();
00737 
00738   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00739   reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"3"</span> ) );
00740   reject.<a class="code" href="class_f_i_x_1_1_message.html#a15">reverseRoute</a>( message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00741   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00742 
00743   MsgSeqNum msgSeqNum;
00744   MsgType msgType;
00745 
00746   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00747   <span class="keywordflow">if</span>( message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( msgSeqNum ) )
00748   {
00749     message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00750     <span class="keywordflow">if</span>( msgSeqNum.getString() != <span class="stringliteral">""</span> )
00751       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefSeqNum( msgSeqNum ) );
00752   }
00753 
00754   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 )
00755   {
00756     <span class="keywordflow">if</span>( msgType.getString() != <span class="stringliteral">""</span> )
00757       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefMsgType( msgType ) );
00758     <span class="keywordflow">if</span> ( (beginString == FIX::BeginString_FIX42
00759           &amp;&amp; err &lt;= <a class="code" href="namespace_f_i_x.html#a1137">SessionRejectReason_INVALID_MSGTYPE</a>)
00760           || beginString &gt; FIX::BeginString_FIX42 )
00761     {
00762       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( SessionRejectReason( err ) );
00763     }
00764   }
00765   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> &amp;&amp; msgType != <a class="code" href="namespace_f_i_x.html#a238">MsgType_SequenceReset</a>
00766        &amp;&amp; msgSeqNum == <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() )
00767   { <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>(); }
00768 
00769   <span class="keyword">const</span> <span class="keywordtype">char</span>* reason = 0;
00770   <span class="keywordflow">switch</span> ( err )
00771   {
00772     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1126">SessionRejectReason_INVALID_TAG_NUMBER</a>:
00773     reason = <a class="code" href="namespace_f_i_x.html#a1882">SessionRejectReason_INVALID_TAG_NUMBER_TEXT</a>;
00774     <span class="keywordflow">break</span>;
00775     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1127">SessionRejectReason_REQUIRED_TAG_MISSING</a>:
00776     reason = <a class="code" href="namespace_f_i_x.html#a1883">SessionRejectReason_REQUIRED_TAG_MISSING_TEXT</a>;
00777     <span class="keywordflow">break</span>;
00778     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1128">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE</a>:
00779     reason = <a class="code" href="namespace_f_i_x.html#a1884">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE_TEXT</a>;
00780     <span class="keywordflow">break</span>;
00781     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1130">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE</a>:
00782     reason = <a class="code" href="namespace_f_i_x.html#a1886">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE_TEXT</a>;
00783     <span class="keywordflow">break</span>;
00784     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1131">SessionRejectReason_VALUE_IS_INCORRECT</a>:
00785     reason = <a class="code" href="namespace_f_i_x.html#a1887">SessionRejectReason_VALUE_IS_INCORRECT_TEXT</a>;
00786     <span class="keywordflow">break</span>;
00787     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1132">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE</a>:
00788     reason = <a class="code" href="namespace_f_i_x.html#a1888">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE_TEXT</a>;
00789     <span class="keywordflow">break</span>;
00790     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1135">SessionRejectReason_COMPID_PROBLEM</a>:
00791     reason = <a class="code" href="namespace_f_i_x.html#a1891">SessionRejectReason_COMPID_PROBLEM_TEXT</a>;
00792     <span class="keywordflow">break</span>;
00793     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1136">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM</a>:
00794     reason = <a class="code" href="namespace_f_i_x.html#a1892">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM_TEXT</a>;
00795     <span class="keywordflow">break</span>;
00796     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1137">SessionRejectReason_INVALID_MSGTYPE</a>:
00797     reason = <a class="code" href="namespace_f_i_x.html#a1893">SessionRejectReason_INVALID_MSGTYPE_TEXT</a>;
00798     <span class="keywordflow">break</span>;
00799     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1139">SessionRejectReason_TAG_APPEARS_MORE_THAN_ONCE</a>:
00800     reason = <a class="code" href="namespace_f_i_x.html#a1894">SessionRejectReason_TAG_APPEARS_MORE_THAN_ONCE_TEXT</a>;
00801     <span class="keywordflow">break</span>;
00802     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1140">SessionRejectReason_TAG_SPECIFIED_OUT_OF_REQUIRED_ORDER</a>:
00803     reason = <a class="code" href="namespace_f_i_x.html#a1895">SessionRejectReason_TAG_SPECIFIED_OUT_OF_REQUIRED_ORDER_TEXT</a>;
00804     <span class="keywordflow">break</span>;
00805     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1142">SessionRejectReason_INCORRECT_NUMINGROUP_COUNT_FOR_REPEATING_GROUP</a>:
00806     reason = <a class="code" href="namespace_f_i_x.html#a1896">SessionRejectReason_INCORRECT_NUMINGROUP_COUNT_FOR_REPEATING_GROUP_TEXT</a>;
00807   };
00808 
00809   <span class="keywordflow">if</span> ( reason &amp;&amp; ( field || err == <a class="code" href="namespace_f_i_x.html#a1126">SessionRejectReason_INVALID_TAG_NUMBER</a> ) )
00810   {
00811     <a class="code" href="class_f_i_x_1_1_session.html#d39">populateRejectReason</a>( reject, field, reason );
00812     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected: "</span>
00813                      + reason + <span class="stringliteral">":"</span> + IntConvertor::convert( field ) );
00814   }
00815   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( reason )
00816   {
00817     <a class="code" href="class_f_i_x_1_1_session.html#d39">populateRejectReason</a>( reject, reason );
00818     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString()
00819          + <span class="stringliteral">" Rejected: "</span> + reason );
00820   }
00821   <span class="keywordflow">else</span>
00822     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected"</span> );
00823 
00824   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() )
00825     <span class="keywordflow">throw</span> std::runtime_error( <span class="stringliteral">"Tried to send a reject while not logged on"</span> );
00826 
00827   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( reject );
00828 
00829   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00830 }
00831 
<a name="l00832"></a><a class="code" href="class_f_i_x_1_1_session.html#d36">00832</a> <span class="keywordtype">void</span> Session::generateReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> std::string&amp; str )
00833 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateReject)
00834 
00835   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>();
00836 
00837   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00838   reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <span class="stringliteral">"3"</span> ) );
00839   reject.<a class="code" href="class_f_i_x_1_1_message.html#a15">reverseRoute</a>( message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00840   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00841 
00842   MsgType msgType;
00843   MsgSeqNum msgSeqNum;
00844 
00845   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00846   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00847   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 )
00848     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefMsgType( msgType ) );
00849   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefSeqNum( msgSeqNum ) );
00850 
00851   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> &amp;&amp; msgType != <a class="code" href="namespace_f_i_x.html#a238">MsgType_SequenceReset</a> )
00852     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00853 
00854   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( Text( str ) );
00855   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( reject );
00856   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString()
00857                    + <span class="stringliteral">" Rejected: "</span> + str );
00858 
00859   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00860 }
00861 
<a name="l00862"></a><a class="code" href="class_f_i_x_1_1_session.html#d37">00862</a> <span class="keywordtype">void</span> Session::generateBusinessReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">int</span> err, <span class="keywordtype">int</span> field )
00863 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateBusinessReject)
00864 
00865   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00866   reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <a class="code" href="namespace_f_i_x.html#a240">MsgType_BusinessMessageReject</a> ) );
00867   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00868   MsgType msgType;
00869   MsgSeqNum msgSeqNum;
00870   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00871   message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00872   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefMsgType( msgType ) );
00873   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefSeqNum( msgSeqNum ) );
00874   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( BusinessRejectReason( err ) );
00875   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
00876 
00877   <span class="keyword">const</span> <span class="keywordtype">char</span>* reason = 0;
00878   <span class="keywordflow">switch</span> ( err )
00879   {
00880     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1157">BusinessRejectReason_OTHER</a>:
00881     reason = <a class="code" href="namespace_f_i_x.html#a1897">BusinessRejectReason_OTHER_TEXT</a>;
00882     <span class="keywordflow">break</span>;
00883     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1158">BusinessRejectReason_UNKOWN_ID</a>:
00884     reason = <a class="code" href="namespace_f_i_x.html#a1898">BusinessRejectReason_UNKNOWN_ID_TEXT</a>;
00885     <span class="keywordflow">break</span>;
00886     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1159">BusinessRejectReason_UNKNOWN_SECURITY</a>:
00887     reason = <a class="code" href="namespace_f_i_x.html#a1899">BusinessRejectReason_UNKNOWN_SECURITY_TEXT</a>;
00888     <span class="keywordflow">break</span>;
00889     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1160">BusinessRejectReason_UNSUPPORTED_MESSAGE_TYPE</a>:
00890     reason = <a class="code" href="namespace_f_i_x.html#a1900">BusinessRejectReason_UNSUPPORTED_MESSAGE_TYPE_TEXT</a>;
00891     <span class="keywordflow">break</span>;
00892     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1161">BusinessRejectReason_APPLICATION_NOT_AVAILABLE</a>:
00893     reason = <a class="code" href="namespace_f_i_x.html#a1901">BusinessRejectReason_APPLICATION_NOT_AVAILABLE_TEXT</a>;
00894     <span class="keywordflow">break</span>;
00895     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1162">BusinessRejectReason_CONDITIONALLY_REQUIRED_FIELD_MISSING</a>:
00896     reason = <a class="code" href="namespace_f_i_x.html#a1902">BusinessRejectReason_CONDITIONALLY_REQUIRED_FIELD_MISSING_TEXT</a>;
00897     <span class="keywordflow">break</span>;
00898     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1163">BusinessRejectReason_NOT_AUTHORIZED</a>:
00899     reason = <a class="code" href="namespace_f_i_x.html#a1903">BusinessRejectReason_NOT_AUTHORIZED_TEXT</a>;
00900     <span class="keywordflow">break</span>;
00901     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a1164">BusinessRejectReason_DELIVERTO_FIRM_NOT_AVAILABLE_AT_THIS_TIME</a>:
00902     reason = <a class="code" href="namespace_f_i_x.html#a1904">BusinessRejectReason_DELIVERTO_FIRM_NOT_AVAILABLE_AT_THIS_TIME_TEXT</a>;
00903     <span class="keywordflow">break</span>;
00904   };
00905 
00906   <span class="keywordflow">if</span> ( reason &amp;&amp; field )
00907   {
00908     <a class="code" href="class_f_i_x_1_1_session.html#d39">populateRejectReason</a>( reject, field, reason );
00909     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected: "</span>
00910                      + reason + <span class="stringliteral">":"</span> + IntConvertor::convert( field ) );
00911   }
00912   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( reason )
00913   {
00914     <a class="code" href="class_f_i_x_1_1_session.html#d39">populateRejectReason</a>( reject, reason );
00915     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString()
00916          + <span class="stringliteral">" Rejected: "</span> + reason );
00917   }
00918   <span class="keywordflow">else</span>
00919     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected"</span> );
00920 
00921   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( reject );
00922 
00923   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00924 }
00925 
<a name="l00926"></a><a class="code" href="class_f_i_x_1_1_session.html#d38">00926</a> <span class="keywordtype">void</span> Session::generateLogout( <span class="keyword">const</span> std::string&amp; text )
00927 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::generateLogout)
00928 
00929   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> <a class="code" href="class_f_i_x_1_1_session.html#a3">logout</a>;
00930   logout.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( MsgType( <a class="code" href="namespace_f_i_x.html#a239">MsgType_Logout</a> ) );
00931   <a class="code" href="class_f_i_x_1_1_session.html#d5">fill</a>( logout.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>() );
00932   <span class="keywordflow">if</span> ( text.length() )
00933     logout.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( Text( text ) );
00934   <a class="code" href="class_f_i_x_1_1_session.html#d1">sendRaw</a>( logout );
00935   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>( <span class="keyword">true</span> );
00936 
00937   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00938 }
00939 
<a name="l00940"></a><a class="code" href="class_f_i_x_1_1_session.html#d39">00940</a> <span class="keywordtype">void</span> Session::populateRejectReason( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject, <span class="keywordtype">int</span> field,
00941                                     <span class="keyword">const</span> std::string&amp; text )
00942 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::populateRejectReason)
00943 
00944   MsgType msgType;
00945    reject.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00946 
00947   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a414">MsgType_REJECT</a> 
00948        &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>() &gt;= FIX::BeginString_FIX42 )
00949   {
00950     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( RefTagID( field ) );
00951     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( Text( text ) );
00952   }
00953   <span class="keywordflow">else</span>
00954   {
00955     std::stringstream stream;
00956     stream &lt;&lt; text &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; field &lt;&lt; <span class="stringliteral">")"</span>;
00957     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( Text( stream.str() ) );
00958   }
00959 
00960   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00961 }
00962 
<a name="l00963"></a><a class="code" href="class_f_i_x_1_1_session.html#d40">00963</a> <span class="keywordtype">void</span> Session::populateRejectReason( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject, <span class="keyword">const</span> std::string&amp; text )
00964 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::populateRejectReason)
00965   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( Text( text ) );
00966   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00967 }
00968 
<a name="l00969"></a><a class="code" href="class_f_i_x_1_1_session.html#d41">00969</a> <span class="keywordtype">bool</span> Session::verify( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg, <span class="keywordtype">bool</span> checkTooHigh,
00970                       <span class="keywordtype">bool</span> checkTooLow )
00971 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::verify)
00972 
00973   <span class="keyword">const</span> MsgType* pMsgType = 0;
00974   <span class="keyword">const</span> MsgSeqNum* pMsgSeqNum = 0;
00975 
00976   <span class="keywordflow">try</span>
00977   {
00978     <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
00979 
00980     pMsgType = <a class="code" href="_field_map_8h.html#a1">FIELD_GET_PTR</a>( header, MsgType );
00981     <span class="keyword">const</span> SenderCompID&amp; senderCompID = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, SenderCompID );
00982     <span class="keyword">const</span> TargetCompID&amp; targetCompID = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, TargetCompID );
00983     <span class="keyword">const</span> SendingTime&amp; sendingTime = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, SendingTime );
00984 
00985     <span class="keywordflow">if</span>( checkTooHigh || checkTooLow )
00986       pMsgSeqNum = <a class="code" href="_field_map_8h.html#a1">FIELD_GET_PTR</a>( header, MsgSeqNum );
00987 
00988     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d12">validLogonState</a>( *pMsgType ) )
00989       <span class="keywordflow">throw</span> std::logic_error( <span class="stringliteral">"Logon state is not valid for message"</span> );
00990 
00991     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d6">isGoodTime</a>( sendingTime ) )
00992     {
00993       <a class="code" href="class_f_i_x_1_1_session.html#d14">doBadTime</a>( msg );
00994       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00995     }
00996     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d10">isCorrectCompID</a>( senderCompID, targetCompID ) )
00997     {
00998       <a class="code" href="class_f_i_x_1_1_session.html#d15">doBadCompID</a>( msg );
00999       <span class="keywordflow">return</span> <span class="keyword">false</span>;
01000     }
01001 
01002     <span class="keywordflow">if</span> ( checkTooHigh &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#d8">isTargetTooHigh</a>( *pMsgSeqNum ) )
01003     {
01004       <a class="code" href="class_f_i_x_1_1_session.html#d18">doTargetTooHigh</a>( msg );
01005       <span class="keywordflow">return</span> <span class="keyword">false</span>;
01006     }
01007     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( checkTooLow &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#d9">isTargetTooLow</a>( *pMsgSeqNum ) )
01008     {
01009       <a class="code" href="class_f_i_x_1_1_session.html#d17">doTargetTooLow</a>( msg );
01010       <span class="keywordflow">return</span> <span class="keyword">false</span>;
01011     }
01012 
01013     <span class="keywordflow">if</span> ( (checkTooHigh || checkTooLow) &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a21">resendRequested</a>() )
01014     {
01015       <a class="code" href="class_f_i_x_1_1_session_state.html#w0">SessionState::ResendRange</a> range = <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a22">resendRange</a>();
01016  
01017       <span class="keywordflow">if</span> ( *pMsgSeqNum &gt;= range.second )
01018       {
01019         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a> (<span class="stringliteral">"ResendRequest for messages FROM: "</span> +
01020                          IntConvertor::convert (range.first) + <span class="stringliteral">" TO: "</span> +
01021                          IntConvertor::convert (range.second) +
01022                          <span class="stringliteral">" has been satisfied."</span>);
01023         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a22">resendRange</a> (0, 0);
01024       }
01025     }
01026   }
01027   <span class="keywordflow">catch</span> ( std::exception&amp; e )
01028   {
01029     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() );
01030     <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
01031     <span class="keywordflow">return</span> <span class="keyword">false</span>;
01032   }
01033 
01034   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
01035   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a34">lastReceivedTime</a>( now );
01036   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">testRequest</a>( 0 );
01037 
01038   <a class="code" href="class_f_i_x_1_1_session.html#d13">fromCallback</a>( pMsgType ? *pMsgType : MsgType(), msg, <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01039   <span class="keywordflow">return</span> <span class="keyword">true</span>;
01040 
01041   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01042 }
01043 
<a name="l01044"></a><a class="code" href="class_f_i_x_1_1_session.html#d11">01044</a> <span class="keywordtype">bool</span> Session::shouldSendReset()
01045 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::shouldSendReset)
01046 
01047   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>();
01048   <span class="keywordflow">return</span> beginString &gt;= FIX::BeginString_FIX41
01049     &amp;&amp; ( <a class="code" href="class_f_i_x_1_1_session.html#r7">m_resetOnLogon</a> || 
01050          <a class="code" href="class_f_i_x_1_1_session.html#r8">m_resetOnLogout</a> || 
01051          <a class="code" href="class_f_i_x_1_1_session.html#r9">m_resetOnDisconnect</a> )
01052     &amp;&amp; ( <a class="code" href="class_f_i_x_1_1_session.html#a49">getExpectedSenderNum</a>() == 1 )
01053     &amp;&amp; ( <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() == 1 );
01054 
01055   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01056 }
01057 
<a name="l01058"></a><a class="code" href="class_f_i_x_1_1_session.html#d12">01058</a> <span class="keywordtype">bool</span> Session::validLogonState( <span class="keyword">const</span> MsgType&amp; msgType )
01059 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::validLogonState)
01060 
01061   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a11">sentReset</a>() || <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">receivedReset</a>() )
01062     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01063   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>()
01064        || msgType != <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() )
01065     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01066   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a239">MsgType_Logout</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>() )
01067     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01068   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a239">MsgType_Logout</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>() )
01069     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01070   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a238">MsgType_SequenceReset</a> ) 
01071     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01072   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a237">MsgType_Reject</a> )
01073     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01074 
01075   <span class="keywordflow">return</span> <span class="keyword">false</span>;
01076 
01077   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01078 }
01079 
<a name="l01080"></a><a class="code" href="class_f_i_x_1_1_session.html#d13">01080</a> <span class="keywordtype">void</span> Session::fromCallback( <span class="keyword">const</span> MsgType&amp; msgType, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg,
01081                             <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01082 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::fromCallback)
01083 
01084   <span class="keywordflow">if</span> ( Message::isAdminMsgType( msgType ) )
01085     m_application.<a class="code" href="class_f_i_x_1_1_application.html#a6">fromAdmin</a>( msg, <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01086   <span class="keywordflow">else</span>
01087     m_application.<a class="code" href="class_f_i_x_1_1_application.html#a7">fromApp</a>( msg, <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01088 
01089   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01090 }
01091 
<a name="l01092"></a><a class="code" href="class_f_i_x_1_1_session.html#d14">01092</a> <span class="keywordtype">void</span> Session::doBadTime( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
01093 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::doBadTime)
01094 
01095   <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( msg, <a class="code" href="namespace_f_i_x.html#a1136">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM</a> );
01096   <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>();
01097 
01098   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01099 }
01100 
<a name="l01101"></a><a class="code" href="class_f_i_x_1_1_session.html#d15">01101</a> <span class="keywordtype">void</span> Session::doBadCompID( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
01102 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::doBadCompID)
01103 
01104   <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( msg, <a class="code" href="namespace_f_i_x.html#a1135">SessionRejectReason_COMPID_PROBLEM</a> );
01105   <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>();
01106 
01107   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01108 }
01109 
<a name="l01110"></a><a class="code" href="class_f_i_x_1_1_session.html#d16">01110</a> <span class="keywordtype">bool</span> Session::doPossDup( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
01111 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::doPossDup)
01112 
01113   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a> &amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
01114   OrigSendingTime origSendingTime;
01115   SendingTime sendingTime;
01116   MsgType msgType;
01117 
01118   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
01119   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( sendingTime );
01120 
01121   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a238">MsgType_SequenceReset</a> )
01122   {
01123     <span class="keywordflow">if</span> ( !header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( origSendingTime ) )
01124     {
01125       <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( msg, <a class="code" href="namespace_f_i_x.html#a1127">SessionRejectReason_REQUIRED_TAG_MISSING</a>, origSendingTime.getField() );
01126       <span class="keywordflow">return</span> <span class="keyword">false</span>;
01127     }
01128     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( origSendingTime );
01129 
01130     <span class="keywordflow">if</span> ( origSendingTime &gt; sendingTime )
01131     {
01132       <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( msg, <a class="code" href="namespace_f_i_x.html#a1136">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM</a> );
01133       <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>();
01134       <span class="keywordflow">return</span> <span class="keyword">false</span>;
01135     }
01136   }
01137   <span class="keywordflow">return</span> <span class="keyword">true</span>;
01138 
01139   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01140 }
01141 
<a name="l01142"></a><a class="code" href="class_f_i_x_1_1_session.html#d17">01142</a> <span class="keywordtype">bool</span> Session::doTargetTooLow( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
01143 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::doTargetTooLow)
01144 
01145   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a> &amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
01146   PossDupFlag possDupFlag(<span class="keyword">false</span>);
01147   MsgSeqNum msgSeqNum;
01148   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>(possDupFlag) )
01149     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( possDupFlag );
01150   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
01151 
01152   <span class="keywordflow">if</span> ( !possDupFlag )
01153   {
01154     std::stringstream stream;
01155     stream &lt;&lt; <span class="stringliteral">"MsgSeqNum too low, expecting "</span> &lt;&lt; <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>()
01156            &lt;&lt; <span class="stringliteral">" but received "</span> &lt;&lt; msgSeqNum;
01157     <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>( stream.str() );
01158     <span class="keywordflow">throw</span> std::logic_error( stream.str() );
01159   }
01160 
01161   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#d16">doPossDup</a>( msg );
01162 
01163   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01164 }
01165 
<a name="l01166"></a><a class="code" href="class_f_i_x_1_1_session.html#d18">01166</a> <span class="keywordtype">void</span> Session::doTargetTooHigh( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
01167 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::doTargetTooHigh)
01168 
01169   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a> &amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
01170   BeginString beginString;
01171   MsgSeqNum msgSeqNum;
01172   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( beginString );
01173   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
01174 
01175   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"MsgSeqNum too high, expecting "</span>
01176                    + IntConvertor::convert( <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() )
01177                    + <span class="stringliteral">" but received "</span>
01178                    + IntConvertor::convert( msgSeqNum ) );
01179 
01180   <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a47">queue</a>( msgSeqNum, msg );
01181 
01182   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a21">resendRequested</a>() )
01183   {
01184     <a class="code" href="class_f_i_x_1_1_session_state.html#w0">SessionState::ResendRange</a> range = <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a22">resendRange</a>();
01185 
01186     <span class="keywordflow">if</span>( !<a class="code" href="class_f_i_x_1_1_session.html#r3">m_sendRedundantResendRequests</a> &amp;&amp; msgSeqNum &gt;= range.first )
01187     {
01188           <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a> (<span class="stringliteral">"Already sent ResendRequest FROM: "</span> +
01189                            IntConvertor::convert (range.first) + <span class="stringliteral">" TO: "</span> +
01190                            IntConvertor::convert (range.second) +
01191                            <span class="stringliteral">".  Not sending another."</span>);
01192           <span class="keywordflow">return</span>;
01193     }
01194   }
01195 
01196   <a class="code" href="class_f_i_x_1_1_session.html#d30">generateResendRequest</a>( beginString, msgSeqNum );
01197 
01198   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01199 }
01200 
<a name="l01201"></a><a class="code" href="class_f_i_x_1_1_session.html#d19">01201</a> <span class="keywordtype">void</span> Session::nextQueued()
01202 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextQueued)
01203   <span class="keywordflow">while</span> ( <a class="code" href="class_f_i_x_1_1_session.html#d19">nextQueued</a>( <a class="code" href="class_f_i_x_1_1_session.html#a50">getExpectedTargetNum</a>() ) ) {}
01204   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01205 }
01206 
<a name="l01207"></a><a class="code" href="class_f_i_x_1_1_session.html#d20">01207</a> <span class="keywordtype">bool</span> Session::nextQueued( <span class="keywordtype">int</span> num )
01208 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::nextQueued)
01209 
01210   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> msg;
01211   MsgType msgType;
01212 
01213   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a48">retreive</a>( num, msg ) )
01214   {
01215     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Processing QUEUED message: "</span>
01216                      + IntConvertor::convert( num ) );
01217     msg.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
01218     <span class="keywordflow">if</span>( msgType == <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a>
01219         || msgType == <a class="code" href="namespace_f_i_x.html#a236">MsgType_ResendRequest</a> )
01220     {
01221       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
01222     }
01223     <span class="keywordflow">else</span>
01224     {
01225       std::string msgString;
01226       <a class="code" href="class_f_i_x_1_1_session.html#a45">next</a>( msg.<a class="code" href="class_f_i_x_1_1_message.html#a11">toString</a>(msgString), <span class="keyword">true</span> );
01227     }
01228     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01229   }
01230   <span class="keywordflow">return</span> <span class="keyword">false</span>;
01231 
01232   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01233 }
01234 
<a name="l01235"></a><a class="code" href="class_f_i_x_1_1_session.html#a46">01235</a> <span class="keywordtype">void</span> Session::next( <span class="keyword">const</span> std::string&amp; msg, <span class="keywordtype">bool</span> queued )
01236 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::next)
01237 
01238   <span class="keywordflow">try</span>
01239   {
01240     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a62">onIncoming</a>( msg );
01241     <a class="code" href="class_f_i_x_1_1_session.html#a45">next</a>( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>( msg, <a class="code" href="class_f_i_x_1_1_session.html#r14">m_dataDictionary</a> ), queued );
01242   }
01243   <span class="keywordflow">catch</span>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; e )
01244   {
01245     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() );
01246 
01247     <span class="keywordflow">try</span>
01248     {
01249       <span class="keywordflow">if</span>( <a class="code" href="namespace_f_i_x.html#a2901">identifyType</a>(msg) == <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> )
01250       {
01251         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Logon message is not valid"</span> );
01252         <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
01253       }
01254     } <span class="keywordflow">catch</span>( <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>&amp; ) {}
01255     <span class="keywordflow">throw</span> e;
01256   }
01257 
01258   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01259 }
01260 
<a name="l01261"></a><a class="code" href="class_f_i_x_1_1_session.html#a47">01261</a> <span class="keywordtype">void</span> Session::next( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">bool</span> queued )
01262 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::next)
01263 
01264   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
01265 
01266   <span class="keywordflow">try</span>
01267   {
01268     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
01269     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d7">checkSessionTime</a>(now) )
01270       { <a class="code" href="class_f_i_x_1_1_session.html#a9">reset</a>(); <span class="keywordflow">return</span>; }
01271 
01272     <span class="keyword">const</span> MsgType&amp; msgType = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, MsgType );
01273     <span class="keyword">const</span> BeginString&amp; beginString = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, BeginString );
01274     <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, SenderCompID );
01275     <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, TargetCompID );
01276 
01277     <span class="keywordflow">if</span> ( beginString != <a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>() )
01278       <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>();
01279 
01280     <a class="code" href="class_f_i_x_1_1_session.html#r14">m_dataDictionary</a>.<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a41">validate</a>( message );
01281 
01282     <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> )
01283       <a class="code" href="class_f_i_x_1_1_session.html#d21">nextLogon</a>( message );
01284     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a233">MsgType_Heartbeat</a> )
01285       <a class="code" href="class_f_i_x_1_1_session.html#d22">nextHeartbeat</a>( message );
01286     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a235">MsgType_TestRequest</a> )
01287       <a class="code" href="class_f_i_x_1_1_session.html#d23">nextTestRequest</a>( message );
01288     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a238">MsgType_SequenceReset</a> )
01289       <a class="code" href="class_f_i_x_1_1_session.html#d26">nextSequenceReset</a>( message );
01290     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a239">MsgType_Logout</a> )
01291       <a class="code" href="class_f_i_x_1_1_session.html#d24">nextLogout</a>( message );
01292     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a236">MsgType_ResendRequest</a> )
01293       <a class="code" href="class_f_i_x_1_1_session.html#d27">nextResendRequest</a>( message );
01294     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a237">MsgType_Reject</a> )
01295       <a class="code" href="class_f_i_x_1_1_session.html#d25">nextReject</a>( message );
01296     <span class="keywordflow">else</span>
01297     {
01298       <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#d41">verify</a>( message ) ) <span class="keywordflow">return</span> ;
01299       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
01300     }
01301   }
01302   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>&amp; e )
01303   { <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() ); }
01304   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_required_tag_missing.html">RequiredTagMissing</a> &amp; e )
01305   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1127">SessionRejectReason_REQUIRED_TAG_MISSING</a>, e.field ) ); }
01306   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a> &amp; e )
01307   {
01308     <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(FIELD::BeginString) &gt;= FIX::BeginString_FIX42 &amp;&amp; message.<a class="code" href="class_f_i_x_1_1_message.html#a27">isApp</a>() )
01309     {
01310       <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d37">generateBusinessReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1162">BusinessRejectReason_CONDITIONALLY_REQUIRED_FIELD_MISSING</a>, e.field ) );
01311     }
01312     <span class="keywordflow">else</span>
01313     {
01314       <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1127">SessionRejectReason_REQUIRED_TAG_MISSING</a>, e.field ) );
01315       <span class="keywordflow">if</span> ( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(FIELD::MsgType) == <a class="code" href="namespace_f_i_x.html#a234">MsgType_Logon</a> )
01316       {
01317         <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( <span class="stringliteral">"Required field missing from logon"</span> );
01318         <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
01319       }
01320     }
01321   }
01322   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_invalid_tag_number.html">InvalidTagNumber</a> &amp; e )
01323   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1126">SessionRejectReason_INVALID_TAG_NUMBER</a>, e.field ) ); }
01324   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_no_tag_value.html">NoTagValue</a> &amp; e )
01325   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1130">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE</a>, e.field ) ); }
01326   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_tag_not_defined_for_message.html">TagNotDefinedForMessage</a> &amp; e )
01327   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1128">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE</a>, e.field ) ); }
01328   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_invalid_message_type.html">InvalidMessageType</a>&amp; )
01329   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1137">SessionRejectReason_INVALID_MSGTYPE</a> ) ); }
01330   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_unsupported_message_type.html">UnsupportedMessageType</a>&amp; )
01331   {
01332     <span class="keywordflow">if</span> ( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(FIELD::BeginString) &gt;= FIX::BeginString_FIX42 )
01333       { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d37">generateBusinessReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1160">BusinessRejectReason_UNSUPPORTED_MESSAGE_TYPE</a> ) ); }
01334     <span class="keywordflow">else</span>
01335       { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <span class="stringliteral">"Unsupported message type"</span> ) ); }
01336   }
01337   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_tag_out_of_order.html">TagOutOfOrder</a> &amp; e )
01338   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1140">SessionRejectReason_TAG_SPECIFIED_OUT_OF_REQUIRED_ORDER</a>, e.field ) ); }
01339   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_incorrect_data_format.html">IncorrectDataFormat</a> &amp; e )
01340   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1132">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE</a>, e.field ) ); }
01341   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_incorrect_tag_value.html">IncorrectTagValue</a> &amp; e )
01342   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1131">SessionRejectReason_VALUE_IS_INCORRECT</a>, e.field ) ); }
01343   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_repeated_tag.html">RepeatedTag</a> &amp; e )
01344   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1139">SessionRejectReason_TAG_APPEARS_MORE_THAN_ONCE</a>, e.field ) ); }
01345   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_repeating_group_count_mismatch.html">RepeatingGroupCountMismatch</a> &amp; e )
01346   { <a class="code" href="_session_8cpp.html#a0">LOGEX</a>( <a class="code" href="class_f_i_x_1_1_session.html#d35">generateReject</a>( message, <a class="code" href="namespace_f_i_x.html#a1142">SessionRejectReason_INCORRECT_NUMINGROUP_COUNT_FOR_REPEATING_GROUP</a>, e.field ) ); }
01347   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; e )
01348   { <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() ); }
01349   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_reject_logon.html">RejectLogon</a>&amp; e )
01350   {
01351     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() );
01352     <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>( e.what() );
01353     <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
01354   }
01355   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>&amp; )
01356   {
01357     <span class="keywordflow">if</span> ( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(FIELD::MsgType) == <a class="code" href="namespace_f_i_x.html#a239">MsgType_Logout</a> )
01358       <a class="code" href="class_f_i_x_1_1_session.html#d24">nextLogout</a>( message );
01359     <span class="keywordflow">else</span>
01360     {
01361       <a class="code" href="class_f_i_x_1_1_session.html#d38">generateLogout</a>( <span class="stringliteral">"Incorrect BeginString"</span> );
01362       <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a57">incrNextTargetMsgSeqNum</a>();
01363     }
01364   }
01365   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_i_o_exception.html">IOException</a>&amp; e )
01366   {
01367     <a class="code" href="class_f_i_x_1_1_session.html#r13">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a64">onEvent</a>( e.what() );
01368     <a class="code" href="class_f_i_x_1_1_session.html#a48">disconnect</a>();
01369   }
01370 
01371   <span class="keywordflow">if</span>( !queued )
01372     <a class="code" href="class_f_i_x_1_1_session.html#d19">nextQueued</a>();
01373 
01374   <span class="keywordflow">if</span>( <a class="code" href="class_f_i_x_1_1_session.html#a8">isLoggedOn</a>() )
01375     <a class="code" href="class_f_i_x_1_1_session.html#a45">next</a>();
01376 
01377   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01378 }
01379 
<a name="l01380"></a><a class="code" href="class_f_i_x_1_1_session.html#e0">01380</a> <span class="keywordtype">bool</span> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> std::string&amp; qualifier )
01381 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a> )
01382 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::sendToTarget)
01383 
01384   <span class="keywordflow">try</span>
01385   {
01386     <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> sessionID = message.getSessionID( qualifier );
01387     <span class="keywordflow">return</span> sendToTarget( message, sessionID );
01388   }
01389   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) { <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>(); }
01390 
01391   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01392 }
01393 
<a name="l01394"></a><a class="code" href="class_f_i_x_1_1_session.html#e1">01394</a> <span class="keywordtype">bool</span> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01395 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a> )
01396 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::sendToTarget)
01397 
01398   message.setSessionID( sessionID );
01399   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = lookupSession( sessionID );
01400   <span class="keywordflow">if</span> ( !pSession ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>();
01401   <span class="keywordflow">return</span> pSession-&gt;<a class="code" href="class_f_i_x_1_1_session.html#a44">send</a>( message );
01402 
01403   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01404 }
01405 
01406 <span class="keywordtype">bool</span> Session::sendToTarget
<a name="l01407"></a><a class="code" href="class_f_i_x_1_1_session.html#e2">01407</a> ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message,
01408   <span class="keyword">const</span> SenderCompID&amp; senderCompID,
01409   <span class="keyword">const</span> TargetCompID&amp; targetCompID,
01410   <span class="keyword">const</span> std::string&amp; qualifier )
01411 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a> )
01412 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::sendToTarget)
01413 
01414   message.getHeader().setField( senderCompID );
01415   message.getHeader().setField( targetCompID );
01416   <span class="keywordflow">return</span> sendToTarget( message, qualifier );
01417 
01418   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01419 }
01420 
01421 <span class="keywordtype">bool</span> Session::sendToTarget
<a name="l01422"></a><a class="code" href="class_f_i_x_1_1_session.html#e3">01422</a> ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> std::string&amp; sender, <span class="keyword">const</span> std::string&amp; target,
01423   <span class="keyword">const</span> std::string&amp; qualifier )
01424 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a> )
01425 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::sendToTarget)
01426 
01427   <span class="keywordflow">return</span> sendToTarget( message, SenderCompID( sender ),
01428                        TargetCompID( target ), qualifier );
01429 
01430   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01431 }
01432 
<a name="l01433"></a><a class="code" href="class_f_i_x_1_1_session.html#e4">01433</a> std::set&lt;SessionID&gt; Session::getSessions()
01434 {
01435   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#v1">s_sessionIDs</a>;
01436 }
01437 
<a name="l01438"></a><a class="code" href="class_f_i_x_1_1_session.html#e5">01438</a> <span class="keywordtype">bool</span> Session::doesSessionExist( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01439 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::doesSessionExist)
01440 
01441   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01442   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.find( sessionID );
01443 
01444   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01445 }
01446 
<a name="l01447"></a><a class="code" href="class_f_i_x_1_1_session.html#e6">01447</a> <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01448 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::lookupSession)
01449 
01450   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01451   Sessions::iterator find = <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.find( sessionID );
01452   <span class="keywordflow">if</span> ( find != <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.end() )
01453     <span class="keywordflow">return</span> find-&gt;second;
01454   <span class="keywordflow">else</span>
01455     <span class="keywordflow">return</span> 0;
01456 
01457   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01458 }
01459 
<a name="l01460"></a><a class="code" href="class_f_i_x_1_1_session.html#e7">01460</a> <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <span class="keyword">const</span> std::string&amp; string, <span class="keywordtype">bool</span> reverse )
01461 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::lookupSession)
01462 
01463   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> message;
01464   <span class="keywordflow">if</span> ( !message.<a class="code" href="class_f_i_x_1_1_message.html#a18">setStringHeader</a>( string ) )
01465     <span class="keywordflow">return</span> 0;
01466 
01467   <span class="keywordflow">try</span>
01468   {
01469     <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>();
01470     <span class="keyword">const</span> BeginString&amp; beginString = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, BeginString );
01471     <span class="keyword">const</span> SenderCompID&amp; senderCompID = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, SenderCompID );
01472     <span class="keyword">const</span> TargetCompID&amp; targetCompID = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( header, TargetCompID );
01473 
01474     <span class="keywordflow">if</span> ( reverse )
01475     {
01476       <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#e6">lookupSession</a>( <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>( beginString, SenderCompID( targetCompID ),
01477                                      TargetCompID( senderCompID ) ) );
01478     }
01479 
01480     <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#e6">lookupSession</a>( <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>( beginString, senderCompID,
01481                           targetCompID ) );
01482   }
01483   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) { <span class="keywordflow">return</span> 0; }
01484 
01485   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01486 }
01487 
<a name="l01488"></a><a class="code" href="class_f_i_x_1_1_session.html#e8">01488</a> <span class="keywordtype">bool</span> Session::isSessionRegistered( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01489 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::isSessionRegistered)
01490 
01491   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01492   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#v2">s_registered</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#v2">s_registered</a>.find( sessionID );
01493 
01494   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01495 }
01496 
<a name="l01497"></a><a class="code" href="class_f_i_x_1_1_session.html#e9">01497</a> <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::registerSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01498 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::registerSession)
01499 
01500   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01501   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = <a class="code" href="class_f_i_x_1_1_session.html#e6">lookupSession</a>( sessionID );
01502   <span class="keywordflow">if</span> ( pSession == 0 ) <span class="keywordflow">return</span> 0;
01503   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#e8">isSessionRegistered</a>( sessionID ) ) <span class="keywordflow">return</span> 0;
01504   <a class="code" href="class_f_i_x_1_1_session.html#v2">s_registered</a>[ sessionID ] = pSession;
01505   <span class="keywordflow">return</span> pSession;
01506 
01507   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01508 }
01509 
<a name="l01510"></a><a class="code" href="class_f_i_x_1_1_session.html#e10">01510</a> <span class="keywordtype">void</span> Session::unregisterSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01511 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::unregisterSession)
01512   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01513   <a class="code" href="class_f_i_x_1_1_session.html#v2">s_registered</a>.erase( sessionID );
01514   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01515 }
01516 
<a name="l01517"></a><a class="code" href="class_f_i_x_1_1_session.html#e11">01517</a> <span class="keywordtype">int</span> Session::numSessions()
01518 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::numSessions)
01519   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01520   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.size();
01521   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01522 }
01523 
<a name="l01524"></a><a class="code" href="class_f_i_x_1_1_session.html#h0">01524</a> <span class="keywordtype">bool</span> Session::addSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
01525 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::addSession)
01526 
01527   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01528   Sessions::iterator it = <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.find( s.<a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01529   <span class="keywordflow">if</span> ( it == <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.end() )
01530   {
01531     <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>[ s.<a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> ] = &amp;s;
01532     <a class="code" href="class_f_i_x_1_1_session.html#v1">s_sessionIDs</a>.insert( s.m_sessionID );
01533     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01534   }
01535   <span class="keywordflow">else</span>
01536     <span class="keywordflow">return</span> <span class="keyword">false</span>;
01537 
01538   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01539 }
01540 
<a name="l01541"></a><a class="code" href="class_f_i_x_1_1_session.html#h1">01541</a> <span class="keywordtype">void</span> Session::removeSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
01542 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Session::removeSession)
01543 
01544   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( s_mutex );
01545   <a class="code" href="class_f_i_x_1_1_session.html#v0">s_sessions</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01546   <a class="code" href="class_f_i_x_1_1_session.html#v1">s_sessionIDs</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01547   <a class="code" href="class_f_i_x_1_1_session.html#v2">s_registered</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#r1">m_sessionID</a> );
01548 
01549   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
01550 }
01551 }
</pre></div><hr><address><small>
Generated on Thu Sep 14 08:52:36 2006 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.6-20040222 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
