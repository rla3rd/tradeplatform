<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/orenmnero/autobuild/quickfix/src/C++/HttpMessage.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.3.6-20040222 -->
<h1>/home/orenmnero/autobuild/quickfix/src/C++/HttpMessage.cpp</h1><a href="_http_message_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** Copyright (c) quickfixengine.org  All rights reserved.</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** This file is part of the QuickFIX FIX Engine</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file may be distributed under the terms of the quickfixengine.org</span>
00007 <span class="comment">** license as defined by quickfixengine.org and appearing in the file</span>
00008 <span class="comment">** LICENSE included in the packaging of this file.</span>
00009 <span class="comment">**</span>
00010 <span class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00011 <span class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00012 <span class="comment">**</span>
00013 <span class="comment">** See http://www.quickfixengine.org/LICENSE for licensing information.</span>
00014 <span class="comment">**</span>
00015 <span class="comment">** Contact ask@quickfixengine.org if any conditions of this licensing are</span>
00016 <span class="comment">** not clear to you.</span>
00017 <span class="comment">**</span>
00018 <span class="comment">****************************************************************************/</span>
00019 
00020 <span class="preprocessor">#ifdef _MSC_VER</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include "stdafx.h"</span>
00022 <span class="preprocessor">#else</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="_call_stack_8h.html">CallStack.h</a>"</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="_http_message_8h.html">HttpMessage.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="_utility_8h.html">Utility.h</a>"</span>
00029 <span class="preprocessor">#include &lt;sstream&gt;</span>
00030 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00031 
00032 <span class="keyword">namespace </span>FIX
00033 {
00034 
<a name="l00035"></a><a class="code" href="class_f_i_x_1_1_http_message.html#a0">00035</a> HttpMessage::HttpMessage() {}
00036 
<a name="l00037"></a><a class="code" href="class_f_i_x_1_1_http_message.html#a1">00037</a> HttpMessage::HttpMessage( <span class="keyword">const</span> std::string&amp; string )
00038 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a> )
00039 {
00040   setString( string );
00041 }
00042 
<a name="l00043"></a><a class="code" href="class_f_i_x_1_1_http_message.html#a3">00043</a> std::string HttpMessage::toString()<span class="keyword"> const</span>
00044 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(HttpMessage::toString)
00045 
00046   std::string str;
00047   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_http_message.html#a3">toString</a>( str );
00048 
00049   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00050 }
00051 
<a name="l00052"></a><a class="code" href="class_f_i_x_1_1_http_message.html#a4">00052</a> std::string&amp; HttpMessage::toString( std::string&amp; str )<span class="keyword"> const</span>
00053 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(HttpMessage::toString)
00054 
00055   str = <a class="code" href="class_f_i_x_1_1_http_message.html#r0">m_root</a> + <a class="code" href="class_f_i_x_1_1_http_message.html#a8">getParameterString</a>();
00056   <span class="keywordflow">return</span> str;
00057 
00058   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00059 }
00060 
<a name="l00061"></a><a class="code" href="class_f_i_x_1_1_http_message.html#a5">00061</a> <span class="keywordtype">void</span> HttpMessage::setString( <span class="keyword">const</span> std::string&amp; string )
00062 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a> )
00063 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(HttpMessage::setString)
00064 
00065   clear();
00066 
00067   std::string::size_type eolPos = string.find( <span class="stringliteral">"\r\n"</span> );
00068   <span class="keywordflow">if</span>( eolPos == std::string::npos ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>();
00069   std::string line = string.substr( 0, eolPos );
00070   std::string::size_type getPos = line.find( <span class="stringliteral">"GET "</span> );
00071   <span class="keywordflow">if</span>( getPos != 0 ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>();
00072   std::string::size_type httpPos = line.rfind( <span class="stringliteral">"HTTP"</span>, std::string::npos );
00073   <span class="keywordflow">if</span>( httpPos == std::string::npos ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>();
00074 
00075   m_root = line.substr( getPos + 4, httpPos - 5 );
00076   std::string::size_type paramPos = m_root.find_first_of( <span class="charliteral">'?'</span> );
00077   <span class="keywordflow">if</span>( paramPos == std::string::npos ) <span class="keywordflow">return</span>;
00078   std::string parameters = m_root.substr( paramPos, m_root.size() - paramPos );
00079   m_root = m_root.substr( 0, paramPos );
00080   paramPos = 0;
00081 
00082   <span class="keywordflow">while</span>( paramPos != std::string::npos )
00083   {
00084     std::string::size_type sepPos = parameters.find_first_of( <span class="stringliteral">"="</span>, paramPos );
00085     <span class="keywordflow">if</span>( sepPos == std::string::npos ) <span class="keywordflow">break</span>;
00086     std::string::size_type tempPos = paramPos;
00087     paramPos = parameters.find_first_of( <span class="stringliteral">"&amp;"</span>, paramPos + 1 );
00088     std::string key = parameters.substr(tempPos + 1, sepPos - tempPos - 1);
00089     std::string value = parameters.substr(sepPos + 1, paramPos - sepPos - 1);
00090     m_parameters[key] = value;
00091   }
00092 
00093   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00094 }
00095 
<a name="l00096"></a><a class="code" href="class_f_i_x_1_1_http_message.html#e0">00096</a> std::string HttpMessage::createResponse( <span class="keywordtype">int</span> error, <span class="keyword">const</span> std::string&amp; text )
00097 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(HttpMessage::createResponse)
00098 
00099   std::string errorString;
00100   <span class="keywordflow">switch</span>( error )
00101   {
00102   <span class="keywordflow">case</span> 100: errorString = <span class="stringliteral">"Continue"</span>; <span class="keywordflow">break</span>;
00103   <span class="keywordflow">case</span> 101: errorString = <span class="stringliteral">"Switching Protocols"</span>; <span class="keywordflow">break</span>;
00104   <span class="keywordflow">case</span> 200: errorString = <span class="stringliteral">"OK"</span>; <span class="keywordflow">break</span>;
00105   <span class="keywordflow">case</span> 201: errorString = <span class="stringliteral">"Created"</span>; <span class="keywordflow">break</span>;
00106   <span class="keywordflow">case</span> 202: errorString = <span class="stringliteral">"Accepted"</span>; <span class="keywordflow">break</span>;
00107   <span class="keywordflow">case</span> 203: errorString = <span class="stringliteral">"Non-Authoritative Information"</span>; <span class="keywordflow">break</span>;
00108   <span class="keywordflow">case</span> 204: errorString = <span class="stringliteral">"No Content"</span>; <span class="keywordflow">break</span>;
00109   <span class="keywordflow">case</span> 205: errorString = <span class="stringliteral">"Reset Content"</span>; <span class="keywordflow">break</span>;
00110   <span class="keywordflow">case</span> 206: errorString = <span class="stringliteral">"Partial Content"</span>; <span class="keywordflow">break</span>;
00111   <span class="keywordflow">case</span> 300: errorString = <span class="stringliteral">"Multiple Choices"</span>; <span class="keywordflow">break</span>;
00112   <span class="keywordflow">case</span> 301: errorString = <span class="stringliteral">"Moved Permanently"</span>; <span class="keywordflow">break</span>;
00113   <span class="keywordflow">case</span> 302: errorString = <span class="stringliteral">"Found"</span>; <span class="keywordflow">break</span>;
00114   <span class="keywordflow">case</span> 303: errorString = <span class="stringliteral">"See Other"</span>; <span class="keywordflow">break</span>;
00115   <span class="keywordflow">case</span> 304: errorString = <span class="stringliteral">"Not Modified"</span>; <span class="keywordflow">break</span>;
00116   <span class="keywordflow">case</span> 305: errorString = <span class="stringliteral">"Use Proxy"</span>; <span class="keywordflow">break</span>;
00117   <span class="keywordflow">case</span> 307: errorString = <span class="stringliteral">"Temporary Redirect"</span>; <span class="keywordflow">break</span>;
00118   <span class="keywordflow">case</span> 400: errorString = <span class="stringliteral">"Bad Request"</span>; <span class="keywordflow">break</span>;
00119   <span class="keywordflow">case</span> 401: errorString = <span class="stringliteral">"Unauthorized"</span>; <span class="keywordflow">break</span>;
00120   <span class="keywordflow">case</span> 402: errorString = <span class="stringliteral">"Payment Required"</span>; <span class="keywordflow">break</span>;
00121   <span class="keywordflow">case</span> 403: errorString = <span class="stringliteral">"Forbidden"</span>; <span class="keywordflow">break</span>;
00122   <span class="keywordflow">case</span> 404: errorString = <span class="stringliteral">"Not Found"</span>; <span class="keywordflow">break</span>;
00123   <span class="keywordflow">case</span> 405: errorString = <span class="stringliteral">"Method Not Allowed"</span>; <span class="keywordflow">break</span>;
00124   <span class="keywordflow">case</span> 406: errorString = <span class="stringliteral">"Not Acceptable"</span>; <span class="keywordflow">break</span>;
00125   <span class="keywordflow">case</span> 407: errorString = <span class="stringliteral">"Proxy Authentication Required"</span>; <span class="keywordflow">break</span>;
00126   <span class="keywordflow">case</span> 408: errorString = <span class="stringliteral">"Request Timeout"</span>; <span class="keywordflow">break</span>;
00127   <span class="keywordflow">case</span> 409: errorString = <span class="stringliteral">"Conflict"</span>; <span class="keywordflow">break</span>;
00128   <span class="keywordflow">case</span> 410: errorString = <span class="stringliteral">"Gone"</span>; <span class="keywordflow">break</span>;
00129   <span class="keywordflow">case</span> 411: errorString = <span class="stringliteral">"Length Required"</span>; <span class="keywordflow">break</span>;
00130   <span class="keywordflow">case</span> 412: errorString = <span class="stringliteral">"Precondition Failed"</span>; <span class="keywordflow">break</span>;
00131   <span class="keywordflow">case</span> 413: errorString = <span class="stringliteral">"Request Entity Too Large"</span>; <span class="keywordflow">break</span>;
00132   <span class="keywordflow">case</span> 414: errorString = <span class="stringliteral">"Request-URI Too Large"</span>; <span class="keywordflow">break</span>;
00133   <span class="keywordflow">case</span> 415: errorString = <span class="stringliteral">"Unsupported Media Type"</span>; <span class="keywordflow">break</span>;
00134   <span class="keywordflow">case</span> 416: errorString = <span class="stringliteral">"Requested Range Not Satisfiable"</span>; <span class="keywordflow">break</span>;
00135   <span class="keywordflow">case</span> 417: errorString = <span class="stringliteral">"Expectation Failed"</span>; <span class="keywordflow">break</span>;
00136   <span class="keywordflow">case</span> 500: errorString = <span class="stringliteral">"Internal Server Error"</span>; <span class="keywordflow">break</span>;
00137   <span class="keywordflow">case</span> 501: errorString = <span class="stringliteral">"Not Implemented"</span>; <span class="keywordflow">break</span>;
00138   <span class="keywordflow">case</span> 502: errorString = <span class="stringliteral">"Bad Gateway"</span>; <span class="keywordflow">break</span>;
00139   <span class="keywordflow">case</span> 503: errorString = <span class="stringliteral">"Service Unavailable"</span>; <span class="keywordflow">break</span>;
00140   <span class="keywordflow">case</span> 504: errorString = <span class="stringliteral">"Gateway Timeout"</span>; <span class="keywordflow">break</span>;
00141   <span class="keywordflow">case</span> 505: errorString = <span class="stringliteral">"HTTP Version not supported"</span>; <span class="keywordflow">break</span>;
00142   <span class="keywordflow">default</span>: errorString = <span class="stringliteral">"Unknown"</span>;
00143   }
00144 
00145   std::stringstream response;
00146   response &lt;&lt; <span class="stringliteral">"HTTP/1.1 "</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; errorString &lt;&lt; <span class="stringliteral">"\r\n"</span>
00147            &lt;&lt; <span class="stringliteral">"Server: QuickFIX"</span> &lt;&lt; <span class="stringliteral">"\r\n"</span>
00148            &lt;&lt; <span class="stringliteral">"Content-Type: text/html; charset=iso-8859-1"</span> &lt;&lt; <span class="stringliteral">"\r\n\r\n"</span>
00149            &lt;&lt; <span class="stringliteral">"&lt;!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"&gt;"</span>;
00150 
00151   <span class="keywordflow">if</span>( error &lt; 200 || error &gt;= 300 )
00152     response &lt;&lt; <span class="stringliteral">"&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;"</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; errorString &lt;&lt; <span class="stringliteral">"&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;"</span>
00153              &lt;&lt; <span class="stringliteral">"&lt;H1&gt;"</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; errorString &lt;&lt; <span class="stringliteral">"&lt;/H1&gt;"</span> &lt;&lt; text &lt;&lt; <span class="stringliteral">"&lt;/BODY&gt;&lt;/HTML&gt;"</span>;
00154   <span class="keywordflow">else</span>
00155     response &lt;&lt; text;
00156 
00157   <span class="keywordflow">return</span> response.str();
00158 
00159   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00160 }
00161 
00162 }
</pre></div><hr><address><small>
Generated on Thu Sep 14 08:52:35 2006 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.6-20040222 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
