<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/orenmnero/autobuild/quickfix/src/C++/Message.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.3.6-20040222 -->
<h1>/home/orenmnero/autobuild/quickfix/src/C++/Message.cpp</h1><a href="_message_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** Copyright (c) quickfixengine.org  All rights reserved.</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** This file is part of the QuickFIX FIX Engine</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file may be distributed under the terms of the quickfixengine.org</span>
00007 <span class="comment">** license as defined by quickfixengine.org and appearing in the file</span>
00008 <span class="comment">** LICENSE included in the packaging of this file.</span>
00009 <span class="comment">**</span>
00010 <span class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00011 <span class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00012 <span class="comment">**</span>
00013 <span class="comment">** See http://www.quickfixengine.org/LICENSE for licensing information.</span>
00014 <span class="comment">**</span>
00015 <span class="comment">** Contact ask@quickfixengine.org if any conditions of this licensing are</span>
00016 <span class="comment">** not clear to you.</span>
00017 <span class="comment">**</span>
00018 <span class="comment">****************************************************************************/</span>
00019 
00020 <span class="preprocessor">#ifdef _MSC_VER</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include "stdafx.h"</span>
00022 <span class="preprocessor">#else</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="_call_stack_8h.html">CallStack.h</a>"</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="_message_8h.html">Message.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="_utility_8h.html">Utility.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="_values_8h.html">Values.h</a>"</span>
00030 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00031 
00032 <span class="keyword">namespace </span>FIX
00033 {
<a name="l00034"></a><a class="code" href="class_f_i_x_1_1_message.html#t0">00034</a> std::auto_ptr&lt;DataDictionary&gt; Message::s_dataDictionary;
00035 
<a name="l00036"></a><a class="code" href="class_f_i_x_1_1_message.html#a0">00036</a> Message::Message()
00037 : m_header( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>::header ) ),
00038   m_trailer( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>::trailer ) ),
00039   m_validStructure( true ) {}
00040 
<a name="l00041"></a><a class="code" href="class_f_i_x_1_1_message.html#a1">00041</a> Message::Message( <span class="keyword">const</span> std::string&amp; string, <span class="keywordtype">bool</span> validate )
00042 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a> )
00043 : m_header( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>( message_order::header ) ),
00044   m_trailer( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>( message_order::trailer ) ),
00045   m_validStructure( <span class="keyword">true</span> )
00046 {
00047   setString( string, validate );
00048 }
00049 
<a name="l00050"></a><a class="code" href="class_f_i_x_1_1_message.html#a2">00050</a> Message::Message( <span class="keyword">const</span> std::string&amp; string,
00051                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary,
00052                   <span class="keywordtype">bool</span> validate )
00053 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a> )
00054 : m_header( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>( message_order::header ) ),
00055   m_trailer( <a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>( message_order::trailer ) ),
00056   m_validStructure( <span class="keyword">true</span> )
00057 {
00058   setString( string, validate, &amp;dataDictionary );
00059 }
00060 
<a name="l00061"></a><a class="code" href="class_f_i_x_1_1_message.html#e0">00061</a> <span class="keywordtype">bool</span> Message::InitializeXML( <span class="keyword">const</span> std::string&amp; url )
00062 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::InitializeXML)
00063 
00064   <span class="keywordflow">try</span>
00065   {
00066     std::auto_ptr&lt;DataDictionary&gt; p =
00067       std::auto_ptr&lt;DataDictionary&gt;(<span class="keyword">new</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>(url));
00068     <a class="code" href="class_f_i_x_1_1_message.html#t0">s_dataDictionary</a> = p;
00069     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00070   }
00071   <span class="keywordflow">catch</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a>&amp; )
00072   { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00073 
00074   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00075 }
00076 
<a name="l00077"></a><a class="code" href="class_f_i_x_1_1_message.html#a15">00077</a> <span class="keywordtype">void</span> Message::reverseRoute( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header )
00078 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::reverseRoute)
00079 
00080   <span class="comment">// required routing tags</span>
00081   BeginString beginString;
00082   SenderCompID senderCompID;
00083   TargetCompID targetCompID;
00084 
00085   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( beginString.getField() );
00086   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( senderCompID.getField() );
00087   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( targetCompID.getField() );
00088 
00089   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( beginString ) )
00090   {
00091     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( beginString );
00092     <span class="keywordflow">if</span>( beginString.getValue().size() )
00093       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( beginString );
00094 
00095     OnBehalfOfLocationID onBehalfOfLocationID;
00096     DeliverToLocationID deliverToLocationID;
00097 
00098     <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( onBehalfOfLocationID.getField() );
00099     <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( deliverToLocationID.getField() );
00100 
00101     <span class="keywordflow">if</span>( beginString &gt;= <a class="code" href="namespace_f_i_x.html#a231">BeginString_FIX41</a> )
00102     {
00103       <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( onBehalfOfLocationID ) )
00104       {
00105         header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( onBehalfOfLocationID );
00106         <span class="keywordflow">if</span>( onBehalfOfLocationID.getValue().size() )
00107           <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( DeliverToLocationID( onBehalfOfLocationID ) );
00108       }
00109 
00110       <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( deliverToLocationID ) )
00111       {
00112         header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( deliverToLocationID );
00113         <span class="keywordflow">if</span>( deliverToLocationID.getValue().size() )
00114           <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( OnBehalfOfLocationID( deliverToLocationID ) );
00115       }
00116     }
00117   }
00118 
00119   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( senderCompID ) )
00120   {
00121     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( senderCompID );
00122     <span class="keywordflow">if</span>( senderCompID.getValue().size() )
00123       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( TargetCompID( senderCompID ) );
00124   }
00125 
00126   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( targetCompID ) )
00127   {
00128     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( targetCompID );
00129     <span class="keywordflow">if</span>( targetCompID.getValue().size() )
00130       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( SenderCompID( targetCompID ) );
00131   }
00132 
00133   <span class="comment">// optional routing tags</span>
00134   OnBehalfOfCompID onBehalfOfCompID;
00135   OnBehalfOfSubID onBehalfOfSubID;
00136   DeliverToCompID deliverToCompID;
00137   DeliverToSubID deliverToSubID;
00138 
00139   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( onBehalfOfCompID.getField() );
00140   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( onBehalfOfSubID.getField() );
00141   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( deliverToCompID.getField() );
00142   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a13">removeField</a>( deliverToSubID.getField() );
00143 
00144   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( onBehalfOfCompID ) )
00145   {
00146     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( onBehalfOfCompID );
00147     <span class="keywordflow">if</span>( onBehalfOfCompID.getValue().size() )
00148       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( DeliverToCompID( onBehalfOfCompID ) );
00149   }
00150 
00151   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( onBehalfOfSubID ) )
00152   {
00153     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( onBehalfOfSubID );
00154     <span class="keywordflow">if</span>( onBehalfOfSubID.getValue().size() )
00155       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( DeliverToSubID( onBehalfOfSubID ) );
00156   }
00157 
00158   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( deliverToCompID ) )
00159   {
00160     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( deliverToCompID );
00161     <span class="keywordflow">if</span>( deliverToCompID.getValue().size() )
00162       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( OnBehalfOfCompID( deliverToCompID ) );
00163   }
00164 
00165   <span class="keywordflow">if</span>( header.<a class="code" href="class_f_i_x_1_1_field_map.html#a11">isSetField</a>( deliverToSubID ) )
00166   {
00167     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( deliverToSubID );
00168     <span class="keywordflow">if</span>( deliverToSubID.getValue().size() )
00169       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( OnBehalfOfSubID( deliverToSubID ) );
00170   }
00171 
00172   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00173 }
00174 
<a name="l00175"></a><a class="code" href="class_f_i_x_1_1_message.html#a11">00175</a> std::string Message::toString( <span class="keywordtype">int</span> beginStringField, 
00176                                <span class="keywordtype">int</span> bodyLengthField, 
00177                                <span class="keywordtype">int</span> checkSumField )<span class="keyword"> const</span>
00178 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::toString)
00179 
00180   std::string str;
00181   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_message.html#a11">toString</a>( str, beginStringField, bodyLengthField, checkSumField );
00182 
00183   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00184 }
00185 
<a name="l00186"></a><a class="code" href="class_f_i_x_1_1_message.html#a12">00186</a> std::string&amp; Message::toString( std::string&amp; str, 
00187                                 <span class="keywordtype">int</span> beginStringField,
00188                                 <span class="keywordtype">int</span> bodyLengthField, 
00189                                 <span class="keywordtype">int</span> checkSumField )<span class="keyword"> const</span>
00190 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::toString)
00191 
00192   <span class="keywordtype">int</span> length = <a class="code" href="class_f_i_x_1_1_message.html#a24">bodyLength</a>( beginStringField, bodyLengthField, checkSumField );
00193   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_int_field.html">IntField</a>(bodyLengthField, length) );
00194   <a class="code" href="class_f_i_x_1_1_message.html#p1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_check_sum_field.html">CheckSumField</a>(checkSumField, <a class="code" href="class_f_i_x_1_1_message.html#a25">checkSum</a>(checkSumField)) );
00195 
00196   <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a25">calculateString</a>( str, <span class="keyword">true</span> );
00197   FieldMap::calculateString( str, <span class="keyword">false</span> );
00198   <a class="code" href="class_f_i_x_1_1_message.html#p1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a25">calculateString</a>( str, <span class="keyword">false</span> );
00199 
00200   <span class="keywordflow">return</span> str;
00201 
00202   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00203 }
00204 
<a name="l00205"></a><a class="code" href="class_f_i_x_1_1_message.html#a13">00205</a> std::string Message::toXML()<span class="keyword"> const</span>
00206 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::toXML)
00207 
00208   std::string str;
00209   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_message.html#a13">toXML</a>( str );
00210 
00211   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00212 }
00213 
<a name="l00214"></a><a class="code" href="class_f_i_x_1_1_message.html#a14">00214</a> std::string&amp; Message::toXML( std::string&amp; str )<span class="keyword"> const</span>
00215 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::toXML)
00216 
00217   std::stringstream stream;
00218   stream &lt;&lt; <span class="stringliteral">"&lt;message&gt;"</span>                         &lt;&lt; std::endl
00219          &lt;&lt; std::setw(2) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;header&gt;"</span>   &lt;&lt; std::endl
00220          &lt;&lt; <a class="code" href="class_f_i_x_1_1_message.html#d2">toXMLFields</a>(<a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>(), 4)
00221          &lt;&lt; std::setw(2) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;/header&gt;"</span>  &lt;&lt; std::endl
00222          &lt;&lt; std::setw(2) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;body&gt;"</span>     &lt;&lt; std::endl
00223          &lt;&lt; <a class="code" href="class_f_i_x_1_1_message.html#d2">toXMLFields</a>(*<span class="keyword">this</span>, 4)
00224          &lt;&lt; std::setw(2) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;/body&gt;"</span>    &lt;&lt; std::endl
00225          &lt;&lt; std::setw(2) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;trailer&gt;"</span>  &lt;&lt; std::endl
00226          &lt;&lt; <a class="code" href="class_f_i_x_1_1_message.html#d2">toXMLFields</a>(<a class="code" href="class_f_i_x_1_1_message.html#a21">getTrailer</a>(), 4)
00227          &lt;&lt; std::setw(2) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;/trailer&gt;"</span> &lt;&lt; std::endl
00228          &lt;&lt; <span class="stringliteral">"&lt;/message&gt;"</span>;
00229 
00230   <span class="keywordflow">return</span> str = stream.str();
00231 
00232   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00233 }
00234 
<a name="l00235"></a><a class="code" href="class_f_i_x_1_1_message.html#d2">00235</a> std::string Message::toXMLFields(<span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; fields, <span class="keywordtype">int</span> space)<span class="keyword"> const</span>
00236 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::toXMLFields)
00237 
00238   std::stringstream stream;
00239   FieldMap::iterator i;
00240   std::string name;
00241   <span class="keywordflow">for</span>(i = fields.<a class="code" href="class_f_i_x_1_1_field_map.html#a28">begin</a>(); i != fields.<a class="code" href="class_f_i_x_1_1_field_map.html#a29">end</a>(); ++i)
00242   {
00243     <span class="keywordtype">int</span> field = i-&gt;first;
00244     std::string value = i-&gt;second.getString();
00245 
00246     stream &lt;&lt; std::setw(space) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;field "</span>;
00247     <span class="keywordflow">if</span>(<a class="code" href="class_f_i_x_1_1_message.html#t0">s_dataDictionary</a>.get() &amp;&amp; <a class="code" href="class_f_i_x_1_1_message.html#t0">s_dataDictionary</a>-&gt;getFieldName(field, name))
00248     {
00249       stream &lt;&lt; <span class="stringliteral">"name=\""</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">"\" "</span>;
00250     }
00251     stream &lt;&lt; <span class="stringliteral">"number=\""</span> &lt;&lt; field &lt;&lt; <span class="stringliteral">"\""</span>;
00252     <span class="keywordflow">if</span>(<a class="code" href="class_f_i_x_1_1_message.html#t0">s_dataDictionary</a>.get()
00253        &amp;&amp; <a class="code" href="class_f_i_x_1_1_message.html#t0">s_dataDictionary</a>-&gt;getValueName(field, value, name))
00254     {
00255       stream &lt;&lt; <span class="stringliteral">" enum=\""</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">"\""</span>;
00256     }
00257     stream &lt;&lt; <span class="stringliteral">"&gt;"</span>;
00258     stream &lt;&lt; <span class="stringliteral">"&lt;![CDATA["</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">"]]&gt;"</span>;
00259     stream &lt;&lt; <span class="stringliteral">"&lt;/field&gt;"</span> &lt;&lt; std::endl;
00260   }
00261 
00262   <a class="code" href="class_f_i_x_1_1_field_map.html#w4">FieldMap::g_iterator</a> j;
00263   <span class="keywordflow">for</span>(j = fields.<a class="code" href="class_f_i_x_1_1_field_map.html#a30">g_begin</a>(); j != fields.<a class="code" href="class_f_i_x_1_1_field_map.html#a31">g_end</a>(); ++j)
00264   {
00265     std::vector&lt;FieldMap*&gt;::const_iterator k;
00266     <span class="keywordflow">for</span>(k = j-&gt;second.begin(); k != j-&gt;second.end(); ++k)
00267     {
00268       stream &lt;&lt; std::setw(space) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;group&gt;"</span> &lt;&lt; std::endl
00269              &lt;&lt; <a class="code" href="class_f_i_x_1_1_message.html#d2">toXMLFields</a>(*(*k), space+2)
00270              &lt;&lt; std::setw(space) &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <span class="stringliteral">"&lt;/group&gt;"</span> &lt;&lt; std::endl;
00271     }
00272   }
00273 
00274   <span class="keywordflow">return</span> stream.str();
00275 
00276   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00277 }
00278 
<a name="l00279"></a><a class="code" href="class_f_i_x_1_1_message.html#a16">00279</a> <span class="keywordtype">void</span> Message::setString( <span class="keyword">const</span> std::string&amp; string,
00280                          <span class="keywordtype">bool</span> doValidation,
00281                          <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>* pDataDictionary )
00282 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a> )
00283 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::setString)
00284 
00285   clear();
00286 
00287   std::string::size_type pos = 0;
00288   <span class="keywordtype">int</span> count = 0;
00289   std::string msg;
00290 
00291   <span class="keyword">static</span> FIELD::Field <span class="keyword">const</span> headerOrder[] =
00292   {
00293     FIELD::BeginString,
00294     FIELD::BodyLength,
00295     FIELD::MsgType
00296   };
00297 
00298   field_type type = header;
00299 
00300   <span class="keywordflow">while</span> ( pos &lt; string.size() )
00301   {
00302     <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a> field = extractField( string, pos, pDataDictionary );
00303     <span class="keywordflow">if</span> ( count &lt; 3 &amp;&amp; headerOrder[ count++ ] != field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() )
00304       <span class="keywordflow">if</span> ( doValidation ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>(<span class="stringliteral">"Header fields out of order"</span>);
00305 
00306     <span class="keywordflow">if</span> ( isHeaderField( field, pDataDictionary ) )
00307     {
00308       <span class="keywordflow">if</span> ( type != header )
00309       {
00310         <span class="keywordflow">if</span>(m_field == 0) m_field = field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>();
00311         m_validStructure = <span class="keyword">false</span>;
00312       }
00313 
00314       <span class="keywordflow">if</span> ( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() == FIELD::MsgType )
00315         msg = field.<a class="code" href="class_f_i_x_1_1_field_base.html#a4">getString</a>();
00316 
00317       m_header.setField( field, <span class="keyword">false</span> );
00318 
00319       <span class="keywordflow">if</span> ( pDataDictionary )
00320         setGroup( <span class="stringliteral">"_header_"</span>, field, string, pos, getHeader(), *pDataDictionary );
00321     }
00322     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isTrailerField( field, pDataDictionary ) )
00323     {
00324       type = trailer;
00325       m_trailer.setField( field, <span class="keyword">false</span> );
00326 
00327       <span class="keywordflow">if</span> ( pDataDictionary )
00328         setGroup( <span class="stringliteral">"_trailer_"</span>, field, string, pos, getTrailer(), *pDataDictionary );
00329     }
00330     <span class="keywordflow">else</span>
00331     {
00332       <span class="keywordflow">if</span> ( type == trailer )
00333       {
00334         <span class="keywordflow">if</span>(m_field == 0) m_field = field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>();
00335         m_validStructure = <span class="keyword">false</span>;
00336       }
00337 
00338       type = body;
00339       setField( field, <span class="keyword">false</span> );
00340 
00341       <span class="keywordflow">if</span> ( pDataDictionary )
00342         setGroup( msg, field, string, pos, *<span class="keyword">this</span>, *pDataDictionary );
00343     }
00344   }
00345 
00346   <span class="keywordflow">if</span> ( doValidation )
00347     validate();
00348 
00349   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00350 }
00351 
<a name="l00352"></a><a class="code" href="class_f_i_x_1_1_message.html#a17">00352</a> <span class="keywordtype">void</span> Message::setGroup( <span class="keyword">const</span> std::string&amp; msg, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a>&amp; field,
00353                         <span class="keyword">const</span> std::string&amp; string,
00354                         std::string::size_type&amp; pos, <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; map,
00355                         <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary )
00356 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::setGroup)
00357 
00358   <span class="keywordtype">int</span> group = field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>();
00359   <span class="keywordtype">int</span> delim;
00360   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>* pDD = 0;
00361   <span class="keywordflow">if</span> ( !dataDictionary.<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a35">getGroup</a>( msg, group, delim, pDD ) ) <span class="keywordflow">return</span> ;
00362   <a class="code" href="class_f_i_x_1_1_group.html">Group</a>* pGroup = 0;
00363 
00364   <span class="keywordflow">while</span> ( pos &lt; string.size() )
00365   {
00366     std::string::size_type oldPos = pos;
00367     <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a> field = <a class="code" href="class_f_i_x_1_1_message.html#d0">extractField</a>( string, pos, &amp;dataDictionary, pGroup );
00368     <span class="keywordflow">if</span> ( (field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() == delim)
00369         || (pGroup == 0 &amp;&amp; pDD-&gt;<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a17">isField</a>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>())) )
00370     {
00371       <span class="keywordflow">if</span> ( pGroup )
00372       {
00373         map.<a class="code" href="class_f_i_x_1_1_field_map.html#a14">addGroup</a>( group, *pGroup, <span class="keyword">false</span> );
00374         <span class="keyword">delete</span> pGroup; pGroup = 0;
00375       }
00376       pGroup = <span class="keyword">new</span> <a class="code" href="class_f_i_x_1_1_group.html">Group</a>( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>(), delim, pDD-&gt;<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a8">getOrderedFields</a>()  );
00377     }
00378     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !pDD-&gt;<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a17">isField</a>( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() ) )
00379     {
00380       <span class="keywordflow">if</span> ( pGroup )
00381       {
00382         map.<a class="code" href="class_f_i_x_1_1_field_map.html#a14">addGroup</a>( group, *pGroup, <span class="keyword">false</span> );
00383         <span class="keyword">delete</span> pGroup; pGroup = 0;
00384       }
00385       pos = oldPos;
00386       <span class="keywordflow">return</span> ;
00387     }
00388 
00389     <span class="keywordflow">if</span> ( !pGroup ) <span class="keywordflow">return</span> ;
00390     pGroup-&gt;<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( field, <span class="keyword">false</span> );
00391     <a class="code" href="class_f_i_x_1_1_message.html#a17">setGroup</a>( msg, field, string, pos, *pGroup, *pDD );
00392   }
00393 
00394   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00395 }
00396 
<a name="l00397"></a><a class="code" href="class_f_i_x_1_1_message.html#a18">00397</a> <span class="keywordtype">bool</span> Message::setStringHeader( <span class="keyword">const</span> std::string&amp; string )
00398 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::setStringHeader)
00399 
00400   <a class="code" href="class_f_i_x_1_1_message.html#a29">clear</a>();
00401 
00402   std::string::size_type pos = 0;
00403   <span class="keywordtype">int</span> count = 0;
00404 
00405   <span class="keywordflow">while</span> ( pos &lt; string.size() )
00406   {
00407     <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a> field = <a class="code" href="class_f_i_x_1_1_message.html#d0">extractField</a>( string, pos );
00408     <span class="keywordflow">if</span> ( count &lt; 3 &amp;&amp; headerOrder[ count++ ] != field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() )
00409       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00410 
00411     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_message.html#e2">isHeaderField</a>( field ) )
00412       <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( field, <span class="keyword">false</span> );
00413     <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
00414   }
00415   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00416 
00417   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00418 }
00419 
<a name="l00420"></a><a class="code" href="class_f_i_x_1_1_message.html#e2">00420</a> <span class="keywordtype">bool</span> Message::isHeaderField( <span class="keywordtype">int</span> field )
00421 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::isHeaderField)
00422 
00423   <span class="keywordflow">switch</span> ( field )
00424   {
00425     <span class="keywordflow">case</span> FIELD::BeginString:
00426     <span class="keywordflow">case</span> FIELD::BodyLength:
00427     <span class="keywordflow">case</span> FIELD::MsgType:
00428     <span class="keywordflow">case</span> FIELD::SenderCompID:
00429     <span class="keywordflow">case</span> FIELD::TargetCompID:
00430     <span class="keywordflow">case</span> FIELD::OnBehalfOfCompID:
00431     <span class="keywordflow">case</span> FIELD::DeliverToCompID:
00432     <span class="keywordflow">case</span> FIELD::SecureDataLen:
00433     <span class="keywordflow">case</span> FIELD::MsgSeqNum:
00434     <span class="keywordflow">case</span> FIELD::SenderSubID:
00435     <span class="keywordflow">case</span> FIELD::SenderLocationID:
00436     <span class="keywordflow">case</span> FIELD::TargetSubID:
00437     <span class="keywordflow">case</span> FIELD::TargetLocationID:
00438     <span class="keywordflow">case</span> FIELD::OnBehalfOfSubID:
00439     <span class="keywordflow">case</span> FIELD::OnBehalfOfLocationID:
00440     <span class="keywordflow">case</span> FIELD::DeliverToSubID:
00441     <span class="keywordflow">case</span> FIELD::DeliverToLocationID:
00442     <span class="keywordflow">case</span> FIELD::PossDupFlag:
00443     <span class="keywordflow">case</span> FIELD::PossResend:
00444     <span class="keywordflow">case</span> FIELD::SendingTime:
00445     <span class="keywordflow">case</span> FIELD::OrigSendingTime:
00446     <span class="keywordflow">case</span> FIELD::XmlDataLen:
00447     <span class="keywordflow">case</span> FIELD::XmlData:
00448     <span class="keywordflow">case</span> FIELD::MessageEncoding:
00449     <span class="keywordflow">case</span> FIELD::LastMsgSeqNumProcessed:
00450     <span class="keywordflow">case</span> FIELD::OnBehalfOfSendingTime:
00451     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00452     <span class="keywordflow">default</span>:
00453     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00454   };
00455 
00456   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00457 }
00458 
<a name="l00459"></a><a class="code" href="class_f_i_x_1_1_message.html#e3">00459</a> <span class="keywordtype">bool</span> Message::isHeaderField( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a>&amp; field,
00460                              <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>* pD )
00461 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::isHeaderField)
00462 
00463   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_message.html#e2">isHeaderField</a>( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() ) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00464   <span class="keywordflow">if</span> ( pD ) <span class="keywordflow">return</span> pD-&gt;<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a23">isHeaderField</a>( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() );
00465   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00466 
00467   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00468 }
00469 
<a name="l00470"></a><a class="code" href="class_f_i_x_1_1_message.html#e4">00470</a> <span class="keywordtype">bool</span> Message::isTrailerField( <span class="keywordtype">int</span> field )
00471 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::isTrailerField)
00472 
00473   <span class="keywordflow">switch</span> ( field )
00474   {
00475     <span class="keywordflow">case</span> FIELD::SignatureLength:
00476     <span class="keywordflow">case</span> FIELD::Signature:
00477     <span class="keywordflow">case</span> FIELD::CheckSum:
00478     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00479     <span class="keywordflow">default</span>:
00480     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00481   };
00482 
00483   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00484 }
00485 
<a name="l00486"></a><a class="code" href="class_f_i_x_1_1_message.html#e5">00486</a> <span class="keywordtype">bool</span> Message::isTrailerField( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a>&amp; field,
00487                               <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>* pD )
00488 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::isTrailerField)
00489 
00490   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_message.html#e4">isTrailerField</a>( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() ) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00491   <span class="keywordflow">if</span> ( pD ) <span class="keywordflow">return</span> pD-&gt;<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a25">isTrailerField</a>( field.<a class="code" href="class_f_i_x_1_1_field_base.html#a3">getField</a>() );
00492   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00493 
00494   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00495 }
00496 
<a name="l00497"></a><a class="code" href="class_f_i_x_1_1_message.html#a30">00497</a> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> Message::getSessionID( <span class="keyword">const</span> std::string&amp; qualifier )
00498 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a> )
00499 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::getSessionID)
00500 
00501   BeginString beginString;
00502   SenderCompID senderCompID;
00503   TargetCompID targetCompID;
00504 
00505   getHeader().getField( beginString );
00506   getHeader().getField( senderCompID );
00507   getHeader().getField( targetCompID );
00508 
00509   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>( beginString, senderCompID, targetCompID, qualifier );
00510 
00511   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00512 }
00513 
<a name="l00514"></a><a class="code" href="class_f_i_x_1_1_message.html#a31">00514</a> <span class="keywordtype">void</span> Message::setSessionID( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00515 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::setSessionID)
00516 
00517   <a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( sessionID.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getBeginString</a>() );
00518   <a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( sessionID.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a4">getSenderCompID</a>() );
00519   <a class="code" href="class_f_i_x_1_1_message.html#a19">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( sessionID.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a5">getTargetCompID</a>() );
00520 
00521   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00522 }
00523 
<a name="l00524"></a><a class="code" href="class_f_i_x_1_1_message.html#d1">00524</a> <span class="keywordtype">void</span> Message::validate()
00525 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(Message::validate)
00526 
00527   <span class="keywordflow">try</span>
00528   {
00529     <span class="keyword">const</span> BodyLength&amp; aBodyLength = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( <a class="code" href="class_f_i_x_1_1_message.html#p0">m_header</a>, BodyLength );
00530 
00531     <span class="keywordflow">if</span> ( aBodyLength != <a class="code" href="class_f_i_x_1_1_message.html#a24">bodyLength</a>() )
00532     {
00533       std::stringstream text;
00534       text &lt;&lt; <span class="stringliteral">"Expected BodyLength="</span> &lt;&lt; <a class="code" href="class_f_i_x_1_1_message.html#a24">bodyLength</a>()
00535            &lt;&lt; <span class="stringliteral">", Recieved BodyLength="</span> &lt;&lt; (<span class="keywordtype">int</span>)aBodyLength;
00536       <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>(text.str());
00537     }
00538 
00539     <span class="keyword">const</span> CheckSum&amp; aCheckSum = <a class="code" href="_field_map_8h.html#a2">FIELD_GET_REF</a>( <a class="code" href="class_f_i_x_1_1_message.html#p1">m_trailer</a>, CheckSum );
00540 
00541     <span class="keywordflow">if</span> ( aCheckSum != <a class="code" href="class_f_i_x_1_1_message.html#a25">checkSum</a>() )
00542     {
00543       std::stringstream text;
00544       text &lt;&lt; <span class="stringliteral">"Expected CheckSum="</span> &lt;&lt; <a class="code" href="class_f_i_x_1_1_message.html#a25">checkSum</a>()
00545            &lt;&lt; <span class="stringliteral">", Recieved CheckSum="</span> &lt;&lt; (<span class="keywordtype">int</span>)aCheckSum;
00546       <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>(text.str());
00547     }
00548   }
00549   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; )
00550   {
00551     <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>(<span class="stringliteral">"BodyLength or CheckSum missing"</span>);
00552   }
00553 
00554   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00555 }
00556 }
</pre></div><hr><address><small>
Generated on Thu Sep 14 08:52:35 2006 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.6-20040222 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
