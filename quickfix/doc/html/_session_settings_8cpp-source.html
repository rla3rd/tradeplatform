<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/orenmnero/autobuild/quickfix/src/C++/SessionSettings.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.3.6-20040222 -->
<h1>/home/orenmnero/autobuild/quickfix/src/C++/SessionSettings.cpp</h1><a href="_session_settings_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** Copyright (c) quickfixengine.org  All rights reserved.</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** This file is part of the QuickFIX FIX Engine</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file may be distributed under the terms of the quickfixengine.org</span>
00007 <span class="comment">** license as defined by quickfixengine.org and appearing in the file</span>
00008 <span class="comment">** LICENSE included in the packaging of this file.</span>
00009 <span class="comment">**</span>
00010 <span class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00011 <span class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00012 <span class="comment">**</span>
00013 <span class="comment">** See http://www.quickfixengine.org/LICENSE for licensing information.</span>
00014 <span class="comment">**</span>
00015 <span class="comment">** Contact ask@quickfixengine.org if any conditions of this licensing are</span>
00016 <span class="comment">** not clear to you.</span>
00017 <span class="comment">**</span>
00018 <span class="comment">****************************************************************************/</span>
00019 
00020 <span class="preprocessor">#ifdef _MSC_VER</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include "stdafx.h"</span>
00022 <span class="preprocessor">#else</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="_call_stack_8h.html">CallStack.h</a>"</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="_session_settings_8h.html">SessionSettings.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="_settings_8h.html">Settings.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="_values_8h.html">Values.h</a>"</span>
00030 <span class="preprocessor">#include &lt;fstream&gt;</span>
00031 
00032 <span class="keyword">namespace </span>FIX
00033 {
<a name="l00034"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a1">00034</a> SessionSettings::SessionSettings( std::istream&amp; stream )
00035 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> )
00036 {
00037   stream &gt;&gt; *<span class="keyword">this</span>;
00038 }
00039 
<a name="l00040"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a2">00040</a> SessionSettings::SessionSettings( <span class="keyword">const</span> std::string&amp; file )
00041 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> )
00042 {
00043   std::ifstream fstream( file.c_str() );
00044   <span class="keywordflow">if</span> ( !fstream.is_open() )
00045     <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a>( ( <span class="stringliteral">"File "</span> + file + <span class="stringliteral">" not found"</span> ).c_str() );
00046   fstream &gt;&gt; *<span class="keyword">this</span>;
00047 }
00048 
<a name="l00049"></a><a class="code" href="namespace_f_i_x.html#a2907">00049</a> std::istream&amp; <a class="code" href="namespace_f_i_x.html#a1997">operator&gt;&gt;</a>( std::istream&amp; stream, <a class="code" href="class_f_i_x_1_1_session_settings.html">SessionSettings</a>&amp; s )
00050 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> )
00051 {
00052   <a class="code" href="class_f_i_x_1_1_settings.html">Settings</a> settings;
00053   stream &gt;&gt; settings;
00054 
00055   <a class="code" href="class_f_i_x_1_1_settings.html#w0">Settings::Sections</a> section;
00056 
00057   section = settings.<a class="code" href="class_f_i_x_1_1_settings.html#a0">get</a>( <span class="stringliteral">"DEFAULT"</span> );
00058   <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a> def;
00059   <span class="keywordflow">if</span> ( section.size() )
00060     def = section[ 0 ];
00061   s.set( def );
00062 
00063   section = settings.get( <span class="stringliteral">"SESSION"</span> );
00064   Settings::Sections::size_type session;
00065   <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a> dict;
00066 
00067   <span class="keywordflow">for</span> ( session = 0; session &lt; section.size(); ++session )
00068   {
00069     dict = section[ session ];
00070     dict.<a class="code" href="class_f_i_x_1_1_dictionary.html#a16">merge</a>( def );
00071 
00072     BeginString beginString
00073     ( dict.<a class="code" href="class_f_i_x_1_1_dictionary.html#a5">getString</a>( <a class="code" href="namespace_f_i_x.html#a157">BEGINSTRING</a> ) );
00074     SenderCompID senderCompID
00075     ( dict.<a class="code" href="class_f_i_x_1_1_dictionary.html#a5">getString</a>( <a class="code" href="namespace_f_i_x.html#a158">SENDERCOMPID</a> ) );
00076     TargetCompID targetCompID
00077     ( dict.<a class="code" href="class_f_i_x_1_1_dictionary.html#a5">getString</a>( <a class="code" href="namespace_f_i_x.html#a159">TARGETCOMPID</a> ) );
00078 
00079     std::string sessionQualifier;
00080     <span class="keywordflow">if</span>( dict.<a class="code" href="class_f_i_x_1_1_dictionary.html#a15">has</a>( <a class="code" href="namespace_f_i_x.html#a160">SESSION_QUALIFIER</a> ) )
00081       sessionQualifier = dict.<a class="code" href="class_f_i_x_1_1_dictionary.html#a5">getString</a>( <a class="code" href="namespace_f_i_x.html#a160">SESSION_QUALIFIER</a> );
00082     <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> sessionID( beginString, senderCompID, targetCompID, sessionQualifier );
00083     s.set( sessionID, dict );
00084   }
00085   <span class="keywordflow">return</span> stream;
00086 }
00087 
<a name="l00088"></a><a class="code" href="namespace_f_i_x.html#a2908">00088</a> std::ostream&amp; <a class="code" href="namespace_f_i_x.html#a1905">operator&lt;&lt;</a>( std::ostream&amp; stream, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_settings.html">SessionSettings</a>&amp; s )
00089 {
00090   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a>&amp; defaults = s.<a class="code" href="class_f_i_x_1_1_session_settings.html#r1">m_defaults</a>;
00091   <span class="keywordflow">if</span>( defaults.<a class="code" href="class_f_i_x_1_1_dictionary.html#a4">size</a>() )
00092   {
00093     stream &lt;&lt; <span class="stringliteral">"[DEFAULT]"</span> &lt;&lt; std::endl;
00094     <a class="code" href="class_f_i_x_1_1_dictionary.html#w1">Dictionary::iterator</a> i;
00095     <span class="keywordflow">for</span>( i = defaults.<a class="code" href="class_f_i_x_1_1_dictionary.html#a17">begin</a>(); i != defaults.<a class="code" href="class_f_i_x_1_1_dictionary.html#a18">end</a>(); ++i )
00096       stream &lt;&lt; i-&gt;first &lt;&lt; <span class="stringliteral">"="</span> &lt;&lt; i-&gt;second &lt;&lt; std::endl;
00097     stream &lt;&lt; std::endl;
00098   }
00099 
00100   std::set&lt;SessionID&gt; sessions = s.<a class="code" href="class_f_i_x_1_1_session_settings.html#a9">getSessions</a>();
00101   std::set&lt;SessionID&gt;::iterator i;
00102   <span class="keywordflow">for</span>( i = sessions.begin(); i != sessions.end(); ++i )
00103   {
00104     stream &lt;&lt; <span class="stringliteral">"[SESSION]"</span> &lt;&lt; std::endl;
00105     <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a>&amp; section = s.<a class="code" href="class_f_i_x_1_1_session_settings.html#a4">get</a>( *i );
00106     <span class="keywordflow">if</span>( !section.<a class="code" href="class_f_i_x_1_1_dictionary.html#a4">size</a>() ) <span class="keywordflow">continue</span>;
00107 
00108     <a class="code" href="class_f_i_x_1_1_dictionary.html#w1">Dictionary::iterator</a> i;
00109     <span class="keywordflow">for</span>( i = section.<a class="code" href="class_f_i_x_1_1_dictionary.html#a17">begin</a>(); i != section.<a class="code" href="class_f_i_x_1_1_dictionary.html#a18">end</a>(); ++i )
00110     {
00111       <span class="keywordflow">if</span>( defaults.<a class="code" href="class_f_i_x_1_1_dictionary.html#a15">has</a>(i-&gt;first) &amp;&amp; defaults.<a class="code" href="class_f_i_x_1_1_dictionary.html#a5">getString</a>(i-&gt;first) == i-&gt;second )
00112         <span class="keywordflow">continue</span>;
00113       stream &lt;&lt; i-&gt;first &lt;&lt; <span class="stringliteral">"="</span> &lt;&lt; i-&gt;second &lt;&lt; std::endl;
00114     }
00115     stream &lt;&lt; std::endl;
00116   }
00117 
00118   <span class="keywordflow">return</span> stream;
00119 }
00120 
<a name="l00121"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a3">00121</a> <span class="keyword">const</span> <span class="keywordtype">bool</span> SessionSettings::has( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )<span class="keyword"> const</span>
00122 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(SessionSettings::has)
00123   <span class="keywordflow">return</span> m_settings.find( sessionID ) != m_settings.end();
00124   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00125 }
00126 
<a name="l00127"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a4">00127</a> <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a>&amp; SessionSettings::get( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID ) <span class="keyword">const</span>
00128 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> )
00129 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(SessionSettings::get)
00130 
00131   Dictionaries::const_iterator i;
00132   i = m_settings.find( sessionID );
00133   <span class="keywordflow">if</span> ( i == m_settings.end() ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a>( <span class="stringliteral">"Session not found"</span> );
00134   <span class="keywordflow">return</span> i-&gt;second;
00135 
00136   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00137 }
00138 
<a name="l00139"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a5">00139</a> <span class="keywordtype">void</span> SessionSettings::set( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID,
00140                            <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a> settings )
00141 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> )
00142 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(SessionSettings::set)
00143 
00144   settings.setString( <a class="code" href="namespace_f_i_x.html#a157">BEGINSTRING</a>, sessionID.getBeginString() );
00145   settings.setString( <a class="code" href="namespace_f_i_x.html#a158">SENDERCOMPID</a>, sessionID.getSenderCompID() );
00146   settings.setString( <a class="code" href="namespace_f_i_x.html#a159">TARGETCOMPID</a>, sessionID.getTargetCompID() );
00147 
00148   settings.merge( m_defaults );
00149   validate( settings );
00150   m_settings[ sessionID ] = settings;
00151 
00152   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00153 }
00154 
<a name="l00155"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a7">00155</a> <span class="keywordtype">void</span> SessionSettings::set( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a>&amp; defaults ) <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> ) 
00156 { 
00157   m_defaults = defaults;
00158   Dictionaries::iterator i = m_settings.begin();
00159   <span class="keywordflow">for</span>( i = m_settings.begin(); i != m_settings.end(); ++i )
00160     i-&gt;second.merge( defaults );
00161 }
00162 
<a name="l00163"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#a9">00163</a> std::set &lt; SessionID &gt; SessionSettings::getSessions()<span class="keyword"> const</span>
00164 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(SessionSettings::getSessions)
00165 
00166   std::set &lt; SessionID &gt; result;
00167   Dictionaries::const_iterator i;
00168   <span class="keywordflow">for</span> ( i = m_settings.begin(); i != m_settings.end(); ++i )
00169     result.insert( i-&gt;first );
00170   <span class="keywordflow">return</span> result;
00171 
00172   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00173 }
00174 
<a name="l00175"></a><a class="code" href="class_f_i_x_1_1_session_settings.html#d0">00175</a> <span class="keywordtype">void</span> SessionSettings::validate( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_dictionary.html">Dictionary</a>&amp; dictionary ) <span class="keyword">const</span>
00176 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a> )
00177 {
00178   std::string beginString = dictionary.getString( <a class="code" href="namespace_f_i_x.html#a157">BEGINSTRING</a> );
00179   <span class="keywordflow">if</span>( beginString != <a class="code" href="namespace_f_i_x.html#a232">BeginString_FIX40</a> &amp;&amp;
00180       beginString != <a class="code" href="namespace_f_i_x.html#a231">BeginString_FIX41</a> &amp;&amp;
00181       beginString != <a class="code" href="namespace_f_i_x.html#a230">BeginString_FIX42</a> &amp;&amp;
00182       beginString != <a class="code" href="namespace_f_i_x.html#a229">BeginString_FIX43</a> &amp;&amp;
00183       beginString != <a class="code" href="namespace_f_i_x.html#a228">BeginString_FIX44</a> )
00184   {
00185     <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a>( std::string(<a class="code" href="namespace_f_i_x.html#a157">BEGINSTRING</a>) + <span class="stringliteral">" must be FIX.4.0 to FIX.4.4"</span> );
00186   }
00187 
00188   std::string connectionType = dictionary.getString( <a class="code" href="namespace_f_i_x.html#a161">CONNECTION_TYPE</a> );
00189   <span class="keywordflow">if</span>( connectionType != <span class="stringliteral">"initiator"</span> &amp;&amp;
00190       connectionType != <span class="stringliteral">"acceptor"</span> )
00191   {
00192     <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_config_error.html">ConfigError</a>( std::string(<a class="code" href="namespace_f_i_x.html#a161">CONNECTION_TYPE</a>) + <span class="stringliteral">" must be 'initiator' or 'acceptor'"</span> );
00193   }
00194 }
00195 
00196 }
</pre></div><hr><address><small>
Generated on Thu Sep 14 08:52:36 2006 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.6-20040222 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
