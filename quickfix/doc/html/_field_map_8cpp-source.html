<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/orenmnero/autobuild/quickfix/src/C++/FieldMap.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.3.6-20040222 -->
<h1>/home/orenmnero/autobuild/quickfix/src/C++/FieldMap.cpp</h1><a href="_field_map_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** Copyright (c) quickfixengine.org  All rights reserved.</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** This file is part of the QuickFIX FIX Engine</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file may be distributed under the terms of the quickfixengine.org</span>
00007 <span class="comment">** license as defined by quickfixengine.org and appearing in the file</span>
00008 <span class="comment">** LICENSE included in the packaging of this file.</span>
00009 <span class="comment">**</span>
00010 <span class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00011 <span class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00012 <span class="comment">**</span>
00013 <span class="comment">** See http://www.quickfixengine.org/LICENSE for licensing information.</span>
00014 <span class="comment">**</span>
00015 <span class="comment">** Contact ask@quickfixengine.org if any conditions of this licensing are</span>
00016 <span class="comment">** not clear to you.</span>
00017 <span class="comment">**</span>
00018 <span class="comment">****************************************************************************/</span>
00019 
00020 <span class="preprocessor">#ifdef _MSC_VER</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include "stdafx.h"</span>
00022 <span class="preprocessor">#else</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="_call_stack_8h.html">CallStack.h</a>"</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="_field_map_8h.html">FieldMap.h</a>"</span>
00028 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00029 <span class="preprocessor">#include &lt;iterator&gt;</span>
00030 
00031 <span class="keyword">namespace </span>FIX
00032 {
<a name="l00033"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a3">00033</a> FieldMap::~FieldMap()
00034 { <a class="code" href="_call_stack_8h.html#a2">QF_STACK_IGNORE_BEGIN</a>
00035   <a class="code" href="class_f_i_x_1_1_field_map.html#a22">clear</a>();
00036   <a class="code" href="_call_stack_8h.html#a3">QF_STACK_IGNORE_END</a>
00037 }
00038 
<a name="l00039"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a4">00039</a> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; FieldMap::operator=( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; rhs )
00040 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::operator=)
00041 
00042   <a class="code" href="class_f_i_x_1_1_field_map.html#a22">clear</a>();
00043 
00044   std::copy( rhs.<a class="code" href="class_f_i_x_1_1_field_map.html#r0">m_fields</a>.begin (), rhs.<a class="code" href="class_f_i_x_1_1_field_map.html#r0">m_fields</a>.end(),
00045              std::inserter(m_fields, m_fields.begin()) );
00046 
00047   Groups::const_iterator i;
00048   <span class="keywordflow">for</span> ( i = rhs.<a class="code" href="class_f_i_x_1_1_field_map.html#r1">m_groups</a>.begin(); i != rhs.<a class="code" href="class_f_i_x_1_1_field_map.html#r1">m_groups</a>.end(); ++i )
00049   {
00050     std::vector &lt; FieldMap* &gt; ::const_iterator j;
00051     <span class="keywordflow">for</span> ( j = i-&gt;second.begin(); j != i-&gt;second.end(); ++j )
00052       <a class="code" href="class_f_i_x_1_1_field_map.html#a14">addGroup</a>( i-&gt;first, **j );
00053   }
00054 
00055   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00056 
00057   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00058 }
00059 
<a name="l00060"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a14">00060</a> <span class="keywordtype">void</span> FieldMap::addGroup( <span class="keywordtype">int</span> field, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; group, <span class="keywordtype">bool</span> setCount )
00061 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::addGroup)
00062 
00063   <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a> * pGroup = <span class="keyword">new</span> <a class="code" href="class_f_i_x_1_1_field_map.html#a0">FieldMap</a>( group.<a class="code" href="class_f_i_x_1_1_field_map.html#r0">m_fields</a>.key_comp() );
00064   *pGroup = group;
00065   m_groups[ field ].push_back( pGroup );
00066   Groups::iterator i = m_groups.find( field );
00067   <span class="keywordflow">if</span>( setCount )
00068     <a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_int_field.html">IntField</a>( field, i-&gt;second.size() ) );
00069 
00070   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00071 }
00072 
<a name="l00073"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a15">00073</a> <span class="keywordtype">void</span> FieldMap::replaceGroup( <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> field, <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; group )
00074 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::replaceGroup)
00075 
00076   Groups::const_iterator i = m_groups.find( field );
00077   <span class="keywordflow">if</span> ( i == m_groups.end() ) <span class="keywordflow">return</span>;
00078   <span class="keywordflow">if</span> ( num &lt;= 0 ) <span class="keywordflow">return</span>;
00079   <span class="keywordflow">if</span> ( i-&gt;second.size() &lt; ( <span class="keywordtype">unsigned</span> ) num ) <span class="keywordflow">return</span>;
00080   *( *( i-&gt;second.begin() + ( num - 1 ) ) ) = group;
00081 
00082   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00083 }
00084 
<a name="l00085"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a16">00085</a> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; FieldMap::getGroup( <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> field, <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; group ) <span class="keyword">const</span>
00086 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a> )
00087 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::getGroup)
00088 
00089   Groups::const_iterator i = m_groups.find( field );
00090   <span class="keywordflow">if</span> ( i == m_groups.end() ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>( field );
00091   <span class="keywordflow">if</span> ( num &lt;= 0 ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>( field );
00092   <span class="keywordflow">if</span> ( i-&gt;second.size() &lt; ( <span class="keywordtype">unsigned</span> ) num ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>( field );
00093   group = *( *( i-&gt;second.begin() + ( num - 1 ) ) );
00094   <span class="keywordflow">return</span> group;
00095 
00096   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00097 }
00098 
<a name="l00099"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a17">00099</a> <span class="keywordtype">void</span> FieldMap::removeGroup( <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> field )
00100 {
00101   Groups::iterator i = m_groups.find( field );
00102   <span class="keywordflow">if</span> ( i == m_groups.end() ) <span class="keywordflow">return</span>;
00103   <span class="keywordflow">if</span> ( num &lt;= 0 ) <span class="keywordflow">return</span>;
00104   std::vector&lt; FieldMap* &gt;&amp; vector = i-&gt;second;
00105   <span class="keywordflow">if</span> ( vector.size() &lt; ( <span class="keywordtype">unsigned</span> ) num ) <span class="keywordflow">return</span>;
00106 
00107   std::deque&lt; FieldMap* &gt; queue;
00108   <span class="keywordflow">while</span>( vector.size() &gt; (<span class="keywordtype">unsigned</span>)num )
00109   {
00110     queue.push_back( vector.back() );
00111     vector.pop_back();
00112   }
00113   <span class="keyword">delete</span> vector.back();
00114   vector.pop_back();
00115   <span class="keywordflow">while</span>( queue.size() )
00116   {
00117     vector.push_back( queue.front() );
00118     queue.pop_front();
00119   }
00120 
00121   <span class="keywordflow">if</span>( vector.size() == 0 )
00122   {
00123     m_groups.erase( field );
00124   }
00125   <span class="keywordflow">else</span>
00126   {
00127     <a class="code" href="class_f_i_x_1_1_int_field.html">IntField</a> <a class="code" href="class_f_i_x_1_1_field_map.html#a21">groupCount</a>( field, vector.size() );
00128     <a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( groupCount, <span class="keyword">true</span> );
00129   }
00130 }
00131 
<a name="l00132"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a18">00132</a> <span class="keywordtype">void</span> FieldMap::removeGroup( <span class="keywordtype">int</span> field )
00133 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::removeGroup)
00134   <a class="code" href="class_f_i_x_1_1_field_map.html#a17">removeGroup</a>( <a class="code" href="class_f_i_x_1_1_field_map.html#a21">groupCount</a>(field), field );
00135   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00136 }
00137 
<a name="l00138"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a13">00138</a> <span class="keywordtype">void</span> FieldMap::removeField( <span class="keywordtype">int</span> field )
00139 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::removeField)
00140 
00141   Fields::iterator i = m_fields.find( field );
00142   <span class="keywordflow">if</span> ( i != m_fields.end() )
00143     m_fields.erase( i );
00144 
00145   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00146 }
00147 
<a name="l00148"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a20">00148</a> <span class="keywordtype">bool</span> FieldMap::hasGroup( <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> field )<span class="keyword"> const</span>
00149 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::hasGroup)
00150 
00151   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_field_map.html#a21">groupCount</a>(field) &gt;= num;
00152 
00153   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00154 }
00155 
<a name="l00156"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a19">00156</a> <span class="keywordtype">bool</span> FieldMap::hasGroup( <span class="keywordtype">int</span> field )<span class="keyword"> const</span>
00157 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::hasGroup)
00158 
00159   Groups::const_iterator i = m_groups.find( field );
00160   <span class="keywordflow">return</span> i != m_groups.end();
00161 
00162   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00163 }
00164 
<a name="l00165"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a21">00165</a> <span class="keywordtype">int</span> FieldMap::groupCount( <span class="keywordtype">int</span> field )<span class="keyword"> const</span>
00166 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::groupCount)
00167 
00168   Groups::const_iterator i = m_groups.find( field );
00169   <span class="keywordflow">if</span>( i == m_groups.end() )
00170     <span class="keywordflow">return</span> 0;
00171   <span class="keywordflow">return</span> i-&gt;second.size();
00172 
00173   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00174 }
00175 
<a name="l00176"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a22">00176</a> <span class="keywordtype">void</span> FieldMap::clear()
00177 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::clear)
00178 
00179   m_fields.clear();
00180 
00181   Groups::iterator i;
00182   <span class="keywordflow">for</span> ( i = m_groups.begin(); i != m_groups.end(); ++i )
00183   {
00184     std::vector &lt; FieldMap* &gt; ::iterator j;
00185     <span class="keywordflow">for</span> ( j = i-&gt;second.begin(); j != i-&gt;second.end(); ++j )
00186       <span class="keyword">delete</span> *j;
00187   }
00188   m_groups.clear();
00189 
00190   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00191 }
00192 
<a name="l00193"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a23">00193</a> <span class="keywordtype">bool</span> FieldMap::isEmpty()
00194 { <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::isEmpty)
00195   <span class="keywordflow">return</span> m_fields.size() == 0;
00196   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00197 }
00198 
<a name="l00199"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a24">00199</a> <span class="keywordtype">int</span> FieldMap::totalFields()<span class="keyword"> const</span>
00200 <span class="keyword"></span>{
00201   <span class="keywordtype">int</span> result = m_fields.size();
00202     
00203   Groups::const_iterator i;
00204   <span class="keywordflow">for</span> ( i = m_groups.begin(); i != m_groups.end(); ++i )
00205   {
00206     std::vector &lt; FieldMap* &gt; ::const_iterator j;
00207     <span class="keywordflow">for</span> ( j = i-&gt;second.begin(); j != i-&gt;second.end(); ++j )
00208       result += ( *j ) -&gt;totalFields();
00209   }
00210   <span class="keywordflow">return</span> result;
00211 }
00212 
<a name="l00213"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a25">00213</a> std::string&amp; FieldMap::calculateString( std::string&amp; result, <span class="keywordtype">bool</span> clear )<span class="keyword"> const</span>
00214 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::calculateString)
00215 
00216 #<span class="keywordflow">if</span> defined(_MSC_VER) &amp;&amp; _MSC_VER &lt; 1300
00217   <span class="keywordflow">if</span>( clear ) result = <span class="stringliteral">""</span>;
00218 <span class="preprocessor">#else</span>
00219 <span class="preprocessor"></span>  <span class="keywordflow">if</span>( clear ) result.clear();
00220 <span class="preprocessor">#endif</span>
00221 <span class="preprocessor"></span>
00222   <span class="keywordflow">if</span>( !result.size() )
00223     result.reserve( <a class="code" href="class_f_i_x_1_1_field_map.html#a24">totalFields</a>() * 32 );
00224     
00225   Fields::const_iterator i;
00226   <span class="keywordflow">for</span> ( i = m_fields.begin(); i != m_fields.end(); ++i )
00227   {
00228     result += i-&gt;second.getValue();
00229 
00230     <span class="comment">// add groups if they exist</span>
00231     <span class="keywordflow">if</span>( !m_groups.size() ) <span class="keywordflow">continue</span>;
00232     Groups::const_iterator j = m_groups.find( i-&gt;first );
00233     <span class="keywordflow">if</span> ( j == m_groups.end() ) <span class="keywordflow">continue</span>;
00234     std::vector &lt; FieldMap* &gt; ::const_iterator k;
00235     <span class="keywordflow">for</span> ( k = j-&gt;second.begin(); k != j-&gt;second.end(); ++k )
00236       ( *k ) -&gt;calculateString( result, <span class="keyword">false</span> );
00237   }
00238   <span class="keywordflow">return</span> result;
00239 
00240   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00241 }
00242 
<a name="l00243"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a26">00243</a> <span class="keywordtype">int</span> FieldMap::calculateLength( <span class="keywordtype">int</span> beginStringField,
00244                                <span class="keywordtype">int</span> bodyLengthField,
00245                                <span class="keywordtype">int</span> checkSumField )<span class="keyword"> const</span>
00246 <span class="keyword"></span>{
00247   <span class="keywordtype">int</span> result = 0;
00248   Fields::const_iterator i;
00249   <span class="keywordflow">for</span> ( i = m_fields.begin(); i != m_fields.end(); ++i )
00250   {
00251     <span class="keywordflow">if</span> ( i-&gt;first != beginStringField
00252          &amp;&amp; i-&gt;first != bodyLengthField
00253          &amp;&amp; i-&gt;first != checkSumField )
00254     { result += i-&gt;second.getLength(); }
00255   }
00256 
00257   Groups::const_iterator j;
00258   <span class="keywordflow">for</span> ( j = m_groups.begin(); j != m_groups.end(); ++j )
00259   {
00260     std::vector &lt; FieldMap* &gt; ::const_iterator k;
00261     <span class="keywordflow">for</span> ( k = j-&gt;second.begin(); k != j-&gt;second.end(); ++k )
00262       result += ( *k ) -&gt;calculateLength();
00263   }
00264   <span class="keywordflow">return</span> result;
00265 }
00266 
<a name="l00267"></a><a class="code" href="class_f_i_x_1_1_field_map.html#a27">00267</a> <span class="keywordtype">int</span> FieldMap::calculateTotal( <span class="keywordtype">int</span> checkSumField )<span class="keyword"> const</span>
00268 <span class="keyword"></span>{ <a class="code" href="_call_stack_8h.html#a0">QF_STACK_PUSH</a>(FieldMap::calculateTotal)
00269 
00270   <span class="keywordtype">int</span> result = 0;
00271   Fields::const_iterator i;
00272   <span class="keywordflow">for</span> ( i = m_fields.begin(); i != m_fields.end(); ++i )
00273   {
00274     <span class="keywordflow">if</span> ( i-&gt;first != checkSumField )
00275       result += i-&gt;second.getTotal();
00276   }
00277 
00278   Groups::const_iterator j;
00279   <span class="keywordflow">for</span> ( j = m_groups.begin(); j != m_groups.end(); ++j )
00280   {
00281     std::vector &lt; FieldMap* &gt; ::const_iterator k;
00282     <span class="keywordflow">for</span> ( k = j-&gt;second.begin(); k != j-&gt;second.end(); ++k )
00283       result += ( *k ) -&gt;calculateTotal();
00284   }
00285   <span class="keywordflow">return</span> result;
00286 
00287   <a class="code" href="_call_stack_8h.html#a1">QF_STACK_POP</a>
00288 }
00289 }
</pre></div><hr><address><small>
Generated on Thu Sep 14 08:52:33 2006 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.6-20040222 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
